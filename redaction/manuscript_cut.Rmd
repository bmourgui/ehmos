---
title: "A new method to explicitly estimate the shift of optimum along gradients in multispecies studies"
subtitle: "Running title: Modelling of gradient optimum shifts"
classoption: a4paper
output:
  pdf_document:
    keep_tex: true
  word_document: default
  documentclass: article
fontsize: 12pt
header-includes:
- \usepackage{float}
- \usepackage{lscape}
- \usepackage{amsmath}
- \usepackage{caption}
- \usepackage{lineno}
- \linenumbers
- \usepackage{setspace}\setstretch{1.5}
csl: journal-of-biogeography.csl
bibliography: Paper_EHMOS_cut.bib
---

Bastien Mourguiart$^{1*}$, Benoit Liquet$^{1,2}$, Kerrie Mengersen$^{1,3}$, Thibaut Couturier$^4$, Jérôme Mansons$^5$, Yoan Braud$^6$, Aurélien Besnard$^4$ 

$^1$ Laboratoire de Mathématiques et de leurs Applications, Université de Pau et des Pays de l'Adour, E2S UPPA, CNRS, Anglet, France  
$^2$ School of Mathematical and Physical Sciences, Macquarie University, Sydney, NSW92109, Australia 
$^3$ ARC Centre of Excellence for Mathematical and Statistical Frontiers, School of Mathematical Science, Queensland University of Technology, Brisbane, QLD 4072, Australia  
$^4$ CEFE, Univ Montpellier, CNRS, EPHE-PSL University, IRD, Univ Paul Valéry Montpellier 3, Montpellier, France  
$^5$ Parc National du Mercantour, Nice, France  
$^6$ Bureau d'études Entomia, Vaumeilh, France  
 
$^*$Corresponding author: Bastien Mourguiart, Université de Pau et des Pays de l'Adour, UFR des Sciences et Techniques de la côte basque, 1 allée du parc Montaury, 64600 Anglet, France. Email: bastien.mourguiart@univ-pau.fr

## Acknowledgments
We thank Damien Combrisson from the Ecrin National Park that contributed to earlier stages of this research. We also thank Alain Gueguen to allow us to use his data. B.M. was supported by the UPPA-E2S international chaire of Kerrie Mengersen.

## Conflict of interest statement
All authors declare no conflict of interest.

\newpage


```{r setup2, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# set chunk default options for the document
knitr::opts_chunk$set(echo=FALSE, 
                      message=FALSE, 
                      warning=FALSE, 
                      fig.pos = 'H',
                      fig.align = 'center',
                      tab.pos = 'H')
```

```{r library, message=FALSE, warning=FALSE, include=FALSE}
library(bookdown)
library(knitr)
source(here::here("make.R"))
```

## Abstract
### Aim
Optimum shifts in species–environment relationships are intensively studied in a wide range of ecological topics, including climate change and species invasion. Numerous statistical methods are used to study optimum shifts but, to our knowledge, none explicitly estimate it. We extended an existing model to explicitly estimate optimum shifts for multiple species having symmetrical response curves. We called this new Bayesian hierarchical model the Explicit Hierarchical Model of Optimum Shifts (EHMOS). 

### Location
All locations

### Taxon
All taxa

### Methods
In a simulation study, we compared the accuracy of EHMOS to a mean comparison method and a Bayesian generalized linear mixed model (GLMM). Specifically, we tested if the accuracy of the methods was sensitive to (1) sampling design, (2) species optimum position, and (3) species ecological specialization. In addition, we compared the three methods using a real dataset of investigated optimum shifts in 24 Orthopteran species between two time periods along an elevation gradient.

### Results
Of all the simulated scenarios, EHMOS was the most accurate method. GLMM was the most sensitive method to species optimum position, providing unreliable estimates in the presence of marginal species, i.e. species with an optimum close to a sampling boundary. The mean comparison method was also sensitive to species optimum position and ecological specialization, especially in an unbalanced sampling design, with high negative bias and low interval coverage compared to EHMOS. 
The case study results obtained with EHMOS were consistent with what is expected considering ongoing climate change, with mostly upward shifts, which further improved confidence in the accuracy of the EHMOS method.

### Main conclusions
EHMOS could be used for a wide range of topics and extended to produce new insights, especially in climate change studies. Explicit estimation of optimum shifts notably allows investigation of ecological assumptions that could explain interspecific variability of these shifts.


**Keywords:** Bayesian hierarchical modelling, Generalized Linear Mixed Model (GLMM), mean comparison method, optimum shift, sampling design, species distribution, species ecological specialization, species response curve  

## Introduction

Understanding changes in relationships between species and environmental gradients is of central interest in biogeography. For instance, assessing changes in species distribution along latitudinal [@thorson2016], elevational [@maggini2011] or climatic [@tayleur2015] gradients in response to ongoing climate change is crucial for developing relevant biodiversity change scenarios [@taheri2021]. Modelling these changes is also central in assessing species invasion risks [@elith2010]. The shifts in species phenology, i.e. changes along a temporal gradient, in response to climate change are also well-studied [@moussus2010; @vitasse2021; @strebel2014].  

This research aims at modelling the relationship between species characteristics –  such as occurrence probability [@maggini2011], abundance [@thorson2016] or singing activity [@strebel2014] – and linear covariates describing the studied gradient. These modelled relationships, often named "species response curves" [@tayleur2015], are usually unimodal curves [@oksanen2002]. They are characterized by a width, a maximum, an optimum (i.e. the value on the gradient where the response peak is reached), and a lower and upper limit.  Changes in the relationship could then occur in each of these parameters, providing different and complementary information on the way species are affected by change over the gradient. However, these changes may be difficult to estimate. Changes in width or range limits of the species response curve may for instance be more difficult to estimate than optimum shifts due to sampling design or detectability issues linked to lower abundance near range limits [@shoo2006]. Hence, studying optimum shifts is often favoured over shifts at range limits to disentangle ecological changes from potential sampling artifacts [@shoo2006; @moussus2010; @lenoir2008].

Different modelling frameworks have been developed to study optimum shifts. The simplest is the mean comparison method [e.g. @shoo2006; @freeman2018], also known as the weighted average method [@terbraak1986; @thorson2016], in which mean values of occupied sites on the gradient are compared between two or more samples. However, such optimum estimates could be biased when sampling effort is uneven along the gradient [@shoo2006; @terbraak1986]. Such uneven sampling is common in ecology [@shoo2006; @rumpf2018], especially in cases of sampling difficult-to-access terrains such as mountains. Designing a random sample of a species distribution requires knowing the species distribution prior to sampling it, which is seldom the case. Regression methods, such as generalized linear models (GLMs), more robust to unbalanced sampling design [@terbraak1986], are also commonly used to estimate optimum shifts [@urli2014; @coudun2005; @lenoir2008]. In this approach, two regressions are conducted to estimate the species optimum for each sample separately [@coudun2005]. Shift is calculated as the difference between the two estimated optima [as in @lenoir2008]. Such an analysis makes it difficult to estimate uncertainty around the shift, so this uncertainty is often omitted [e.g. @lembrechts2017; @urli2014]. This absence of uncertainty is prejudicial when post-hoc tests are performed on shift point estimates [@felde2012]. This approach also raises issues for species with an optimum close to the edge of the sampled gradient, hereafter referred to as edge species. In these cases, the regression follows a logistic relationship and does not provide an optimum [@citores2020]. As a consequence, such edge species are usually withdrawn from analysis [e.g. @rumpf2018; @felde2012]; however, they may be particularly sensitive to changes as they are limited by certain constraints (physiological, environmental, etc.) and subject to local extinctions caused by a lack of remaining suitable areas [@freeman2018]. Moreover, estimates of the mean shift at the community level could be biased by the removal of edge species, as the optimum shift could depend on the position along the gradient [@rumpf2018]. A model robust to unbalanced sampling design, providing estimates of uncertainties and including all species whatever the location of their optimum would be a substantial improvement for modelling shift in optima.

We developed an extension of the Gaussian logistic model [@jamil2014; @terbraak1986] that explicitly estimates shifts in optima for several species simultaneously, with their uncertainties. We also fitted a Bayesian Generalized Linear Mixed Model to simultaneously analyse both sampling occasions and all species and use the estimated coefficients to compute posterior distributions of species optimum shifts. The performance of these models was compared to the estimates provided by a simple mean comparison method. The comparison was undertaken through a simulation study involving different sampling designs and ecological scenarios. The goal of the simulation study was to determine if the methods accurately estimate the optimum shifts of multiple species along a virtual environmental gradient. Specifically, we tested if the accuracy of the methods was sensitive to (1) sampling design, i.e. how sampling sites are distributed along the gradient, (2) species marginality, i.e. the location of the species optimum on the gradient, and (3) species ecological specialization, i.e. the width of the species–environment relationship. We finally applied the three methods to Orthoptera species sampled twice 30 years apart in the French Alps along an elevation gradient.

## Materials and methods

### Shift modelling

We used a mean comparison method based on the Student t-test (hereafter, t-test) that compares species' average positions along a gradient between two sampling occasions. In this approach, species' optima are estimated as the mean of environmental values at which the species have been observed. We performed unpaired two-sample Student t-tests between surveys for each species separately. This provided species-specific shift estimates and associated confidence intervals.

We developed and fitted two hierarchical models: a 'classic' Generalized Linear Mixed Model (hereafter, cGLMM) and a new Explicit Hierarchical Model of Optimum Shifts (EHMOS). Both models assumed that the occurrence state (present or absent) observed for species $i$ at site $j$ during sampling occasion $k$, $Y_{i,j,k}$, relies on the probability $\psi_{i,j,k}$ that species $i$ can occupy site $j$ during sampling occasion $k$. In both models, we described the observation data as an outcome of a Bernoulli trial:

$$ Y_{i,j,k} \sim \text{Bernoulli}(\psi_{i,j,k}). $$

We assumed that species occupancy probability is related to the gradient through a symmetric bell-shaped curve with an optimum. However, the two models differ in the formulation of the species–environment relationship. cGLMM allows five shapes of species-environment relationships (flat, monotone, 'plateau', U-shaped or bell-shaped unimodal symmetric response curves) some of which could be ecologically meaningless (e.g. U-shaped curves). EHMOS by its ecological formulation models only symmetric unimodal response curves. However, if EHMOS estimates optimum outside the sampling range, then the estimated SRC will look like a monotone or a 'plateau' relationship. EHMOS ecological formulation also allows direct interpretation of its model coefficients. Note that both models assumed that unimodal species response curves are symmetrical, i.e. occupancy probabilities decrease at the same rate on both sides of the optimum. We discuss this potential limitation further in the manuscript.

*Classic Generalized Linear Mixed Model (cGLMM)* – The occupancy probability was modelled on the logit scale as a regression of linear and quadratic effects of environment. To allow for species-specific occurrence relationships with the gradient, we added a random intercept and random slope effects for the species ID. Changes in species distribution along the gradient between sampling occasions were assessed including a binary covariate, $S_k$, taking the value of 0 for one sampling occasion and 1 for the other, and its interaction with the linear and quadratic effects of the environment. As the same sites were included in the two samples, we added a random intercept term for the site ID, $\gamma^{site}_j \sim N(0, \sigma_{\gamma}^2)$, to account for data dependencies. Hence, in our cGLMM the occupancy model was formulated as follows:

  \begin{equation}
  logit(\psi_{i,j,k}) = \beta_{0i} + \beta_{1i} \times X_j + \beta_{2i} \times {X_j}^2 +
  \beta_{3i} \times S_k + \beta_{4i} \times S_k \times X_j + \beta_{5i} \times S_k \times {X_j}^2 + \gamma^{site}_j
  \label{glmm}
  \end{equation}
  
where $\beta_i$ represents the coefficients related to the species-specific effects mentioned above and $X_j$ is the value of the environmental variable at site $j$. Hence, $\beta_{0i}$, $\beta_{1i}$ and $\beta_{2i}$ describe the relationship between species occurrence and elevation during the first sampling for species $i$, while $\beta_{3i}$, $\beta_{4i}$ and $\beta_{5i}$ denote the changes in the species-specific occurrence–gradient relationship between the two sampling occasions. We calculated the species-specific optimum positions of each sampling occasion, denoted by $\theta_{i,k}$, from these regression coefficients [see Equation 2 in @terbraak1986]. We then calculated species shifts by subtracting optimum values of each sampling occasion as follows:

  \begin{align}
  \begin{split}
  \delta_i &= \theta_{i,2} - \theta_{i,1}  \\
  &= \frac{-(\beta_{1i}+\beta_{4i})}{2 \times (\beta_{2i}+\beta_{5i})} - \frac{-\beta_{1i}}{2 \times \beta_{2i}}
  \label{shift_glmm}
  \end{split}
  \end{align}
  
where $\delta_i$ is the optimum shift of species $i$.  

*Explicit Hierarchical Model of Optimum Shifts (EHMOS)* – We extended the multi-species Gaussian logistic model developed to describe species unique unimodal response curves [@jamil2014] to explicitly estimate shift in optimum positions between two sampling occasions. This model, we called Explicit Hierarchical Model of Optimum Shifts (EHMOS), describes multiple species–environment relationships simultaneously for two samples:

  \begin{equation}
  logit(\psi_{i,j,k}) = \alpha_{i,k} - \frac{[\text{X}_j - (\theta_{i} + (\text{S}_k \times \delta_{i}) )]^2}{2 \times {\tau_{i,k}}^2} +
  \gamma^{site}_j
  \label{eq_ehmos}
  \end{equation}
  
where $\alpha_{i,k}$ represents the maximum occupancy probability on the logit scale reached by species $i$ in sampling occasion $k$; $\theta_i$ is the environmental optimum of species $i$ for the first sampling occasion (as the binary variable $S_k$ is coded as $S_1 = 0$ and $S_2 = 1$); $\delta_i$ is the shift between the two optima for species $i$; $\tau_{i,k}$ is the species' ecological tolerance, a measure of the gradient portion length on which the species could occur (see Appendix S1 in Supporting Information).

In both models (Eq. (\ref{glmm}) and (\ref{eq_ehmos})), the gradient covariate was standardized to have a mean equal to zero and variance equal to one. Each species-specific parameter ($\Theta_i \in \{ \beta_i, \theta_i, \delta_i \}$) was modelled as a random species effect drawn from a normal distribution: $\Theta_i \sim N(\mu_{\Theta}, \sigma_{\Theta}^2)$ described by the community mean ($\mu_{\Theta}$) and the variance between species ($\sigma_{\Theta}^2$). Those community parameters are shared between the two sampling occasions for all the GLMM parameters ($\beta_i$'s), and for the optimum ($\theta_i$) and the shift ($\delta_i$) in the EHMOS model. For the species-specific and occasion-specific parameters $\alpha_{i,k}$ and $\tau_{i,k}$, the community means could vary between sampling occasions (e.g. $\tau_{i,k} \sim N(\mu_{\tau_k}, \sigma_{\tau}^2)$).

We implemented the two models in a Bayesian context. We then obtained posterior distributions for each species-specific parameter. Assuming a lack of prior knowledge of a parameter's true value, hyper-parameters were afforded default priors. We used wide normal priors (with mean 0 and variance 1000) for the means of community-level effects (the $\mu$'s) and inverse-gamma priors ($\text{Inv-gamma}(0.1, 0.1)$) for the community-level variances (the $\sigma^2$'s). In the cGLMM, we computed posterior distributions of the shifts from MCMC samples of the regression coefficients (Eq. (\ref{shift_glmm})). Hence, for both models we had posterior distributions for the species-specific shifts in optimum position. We used medians as point estimates and symmetric 95\% credible intervals as corresponding measures of uncertainty. Symmetric 95\% credible intervals were computed based on 0.025 and 0.975 quantiles of the MCMC posterior distributions.

We coded the two hierarchical Bayesian models in BUGS language and ran them in JAGS [@plummer2003], using the _jagsUI_ package [@kellner2021] in R software [@r2018]. The code is available on GitHub. We ran the analysis with the function `autojags()`, which updates the number of iterations within the burn-in phase until all parameters have a Gelman-Rubin statistic ($\hat{R}$) less than 1.1, suggesting satisfactory convergence [@gelman2013], or when the total number of iterations reached a maximum set at 250,000 iterations. We ran three MCMC chains with a thinning rate of 10 and with an initial burn-in phase of 15,000 iterations that was updated by 15,000 iterations until the specified convergence level was met or the maximum number of iterations was reached.

### Simulation study

We simulated the sampling of a community of 20 species during two sampling occasions at 300 sampling sites distributed along an elevational gradient ranging from 1000 m to 3000 m. We used two sampling design sub-scenarios: the distribution along the virtual elevation gradient of the sampling sites was either uniform, in sampling sub-scenario A1, or unbalanced, in sampling sub-scenario A2 (Fig. \ref{fig:fig1}a). In the unbalanced design, the simulated sampling sites followed a truncated normal distribution of mean 1970 m, standard-deviation 335 m restricted between 1000 m and 3000 m. We chose the mean and standard deviation according to those observed in the motivating example (see below).

We then positioned on the virtual gradient the optima of each species for the two virtual sampling occasions. We defined two optimum sub-scenarios (coded B1 and B2). In optimum sub-scenario B1, 100\% of species had both their optima in the middle of the sampling range, hereafter 'middle species' (green points in Fig. \ref{fig:fig1}b), while in B2 30\% of species (six species) were considered as 'edge species', i.e. had their optima close to the boundaries of the sampled gradient (red points in Fig. \ref{fig:fig1}b). We defined the middle of the sampling range as the part of the gradient that contains 80\% of the sampling sites (green areas in Fig. \ref{fig:fig1}ab), the upper and lower parts of the remaining sampling range were considered the sampling edges (orange areas in Fig. \ref{fig:fig1}ab). We simulated half of the optima of the edge species close to the upper edge, and the other half close to the lower edge. Simultaneously with the optimum of the first sampling occasion (full points in Fig. \ref{fig:fig1}b), we simulated the optimum shift, thus obtaining the second optimum (circles in Fig. \ref{fig:fig1}b), to respect percentages of edge and middle species in both sampling occasions. For all optimum sub-scenarios, we computed 60\% of upward shifts, 20\% of downward shifts and 20\% of no shift to test all kinds of response while keeping the majority of upward shifts as expected in conditions of ongoing climate change. The values of upward and downward shifts were sampled from a uniform distribution bounded between 80 m and 250 m, and ‑250 m and -80 m respectively.

We used two ecological specialization sub-scenarios (C1 and C2). In sub-scenario C1, we simulated only specialist species, i.e. species having a narrow ecological niche and high maximum occurrence probability (Fig. \ref{fig:fig1}c). In sub-scenario C2, we simulated 50\% of specialist and 50\% of generalist species having a wider ecological niche and lower maximum occurrence probability than specialist species (Fig. \ref{fig:fig1}c). We allowed for changes in shape parameters between sampling occasions in both sub-scenarios, but not in ecological specialization type: i.e. a generalist species remains a generalist species, but could have slightly different species response curves in the two sampling occasions. Niche width and maximum occurrence probability were sampled from uniform distributions, independently for the two sampling occasions, with the distribution parameters depending on the ecological specialization type. Specialist species had widths ranging from 400 m and 600 m, while generalists' width ranged between 1200 m and 1400 m. Maximum probability was set between 0.9 and 0.99 for specialist species, and between 0.75 and 0.85 for generalist species. These distribution parameter values were chosen to clearly separate the two types of species and match the values observed in the motivating example. 

We ran all possible combinations of the sub-scenarios, resulting in eight simulated scenarios. In each, we considered each species to have a symmetric unimodal response curve in both sampling occasions (Fig. \ref{fig:fig1}d). We produced site-specific probability of occupancy for each species in each scenario following:

$$logit(\psi_{i,j,k}^{s}) = \alpha_{i,k}^{s} - \frac{[\text{X}_j^{s} - (\theta_{i}^{s} + (\text{S}_k \times \delta_{i}^{s}) )]^2}{2 \times {\tau_{i,k}^{s}}^2}$$

with $\psi_{i,j,k}^{s}$ the occurrence probability of species $i$ at site $j$ during sampling occasion $k$ simulated in scenario $s$, $\text{X}_j^{s}$ is the value on the elevation gradient of site $j$ under scenario $s$, $\theta_{i}^{s}$ and $\delta_{i}^{s}$ are respectively the optimum and shift of species $i$ in scenario $s$, and $\alpha_{i,k}^{s}$ and $\tau_{i,k}^{s}$ are related to niche width and maximum probability of occupancy (see Appendix S1). Observed presence or absence of species $i$ at site $j$ during sampling occasion $k$ under scenario $s$, $Y_{i,j,k}^{s}$, was then drawn from a Benoulli distribution: $Y_{i,j,k}^{s} \sim Bernoulli(\psi_{i,j,k}^{s})$. We replicated the Bernoulli trials 30 times for each of the 8 scenarios, resulting in 240 simulated datasets.

```{r fig1, fig.cap="Example of the simulation process for two scenarios each broken down in three categories of sub-scenarios: (a) the sampling design either uniform (A1) or unbalanced (A2) (b) the optimum positions for the first (full points) and second (circles) sampling occasions of the 20 species, which is either in the middle (green area) or close to the edges (orange areas) of the sampling range in variable proportions depending on sub-scenario category (B1: 100\\% middle, B2: 70\\% middle) (c) the ecological specialization of species, which can be specialist (dark curves) or generalist species (purple curves) in variable proportions depending on the sub-scenario category (100\\% in C1 or 50\\% in C2 of specialist species). The bottom panel represents (d) the species response curves for the first and second sampling occasion (solid and dashed lines) of the two scenarios that results in the combination of the three sub-scenarios above.", fig.dim=c(8.3, 9.4)}

cowplot::plot_grid(g_subscenarA, g_subscenarB, g_subscenarC, g_scenar, 
                   nrow=4,
                   labels=c("(a)", "(b)","(c)","(d)"),
                   label_size = 12)
```


### Model performance assessment

We assessed estimation accuracy and precision through four metrics (i) bias, the difference between true and estimated absolute optimum shifts, (ii) root mean squared error, which combines bias and imprecision, (iii) interval coverage, i.e. the proportion of estimated credible/confidence intervals that contain the true optimum shifts, and (iv) interval score, which combines information on width of credible/confidence intervals and on interval coverage. Details on the calculation of the four metrics are provided in Appendix S2. We also compared the computing performance of the Bayesian models. We counted the number of times when at least one parameter failed to converge after the maximum of iterations was reached. Due to the number of runs and parameters, we just looked at the Gelman-Rubin statistic threshold of 1.1 [@gelman2013] and did not make visual diagnostics. We also computed the average running time for each model.

### Motivating example

Our goal when starting this study was to model shifts in elevation optima of an Orthoptera community studied during two periods separated by 30 years. This study was conducted in 134 sampling sites distributed along an elevation gradient ranging from 928 m to 2614 m (mean = 1869 m) above sea level in Mercantour National Park in the French Alps. The first survey was carried out during the summers between 1983 and 1988 (Gueguen 1990). At each site, the density of Orthoptera species was assessed based on multiple counts made using box quadrats that trapped individuals. The second survey was conducted during the summers of 2018 and 2019. Each sampling site consisted of a circle with a 70-m radius where five spatial replicates (hereafter, plots) 30 m2 in area were surveyed following three successive steps: (1) one minute of listening to species stridulating in the plot, (2) six minutes of sighting species by walking across the plot, and (3) two 45-second sweep netting sessions across the plot [see @mourguiart2021 for a full description of the sampling design]. To minimize the effect of varying sampling effort and detection methods between surveys, we reduced the Orthoptera records to the presence/absence data at the site level and only kept species detected in at least 5\% of sampling sites. We pooled some species' data in a species complex when confusion was possible (genuses *Yersinella*, *Calliptamus*, *Podisma* and *Chorthippus biggutulus-brunneus-mollis-daimei* complex). We fitted the three methods to the 24 taxa kept after data processing. 

## Results

In the convergence check, we observed that 50\% of the cGLMMs failed to converge in the simulations (see details in Appendix S3 as Table S3.1). Due to the running time, `r m.compute_time[m.compute_time$model == "glmm", ]$mean` hours (SD = `r m.compute_time[m.compute_time$model == "glmm", ]$SD` hours) on average for cGLMM (see in Appendix S3 as Table S3.2), we chose not to re-run more iterations of models that did not converge. All models converged for EHMOS and took on average `r m.compute_time[m.compute_time$model == "ehmos", ]$mean` hours (SD = `r m.compute_time[m.compute_time$model == "ehmos", ]$SD` hour) for this process (see in Appendix S3 as Table S3.2). In the motivating example, both models converged: EHMOS ran in `r round(out_appli_ehmos$mcmc.info$elapsed.mins, 0)` minutes and cGLMM in `r round(out_appli_glmm$mcmc.info$elapsed.mins, 0)` minutes.

### Simulation

Averaging performance metrics for all species in the eight scenarios, we found that EHMOS performed better than cGLMM and t-test whatever the performance metrics. EHMOS had the smallest average RMSE (mean = `r round(overall_perf[overall_perf$model == "ehmos", ]$m.RMSE, 0)`, SD = `r round(overall_perf[overall_perf$model == "ehmos", ]$sd.RMSE, 0)`), bias (mean = `r round(overall_perf[overall_perf$model == "ehmos", ]$m.bias, 0)`, SD = `r round(overall_perf[overall_perf$model == "ehmos", ]$sd.bias, 0)`), interval score (mean = `r round(overall_perf[overall_perf$model == "ehmos", ]$m.IS, 0)`, SD = `r round(overall_perf[overall_perf$model == "ehmos", ]$sd.IS, 0)`), and the largest interval coverage (mean = `r round(overall_perf[overall_perf$model == "ehmos", ]$m.coverage, 2)`, SD = `r round(overall_perf[overall_perf$model == "ehmos", ]$sd.coverage, 2)`). cGLMM had similar interval coverage to EHMOS (mean = `r round(overall_perf[overall_perf$model == "glmm", ]$m.coverage, 2)`, SD = `r round(overall_perf[overall_perf$model == "glmm", ]$sd.coverage, 2)`), but relatively high positive bias (mean = `r round(overall_perf[overall_perf$model == "glmm", ]$m.bias, 0)`, SD = `r round(overall_perf[overall_perf$model == "glmm", ]$sd.bias, 0)`), the largest RMSE of all three methods (mean = `r round(overall_perf[overall_perf$model == "glmm", ]$m.RMSE, 0)`, SD = `r round(overall_perf[overall_perf$model == "glmm", ]$sd.RMSE, 0)`), and interval score (mean = `r round(overall_perf[overall_perf$model == "glmm", ]$m.IS, 0)`, SD = `r round(overall_perf[overall_perf$model == "glmm", ]$sd.IS, 0)`). The t-test had an intermediate RMSE (mean = `r round(overall_perf[overall_perf$model == "t.test", ]$m.RMSE, 0)`, SD = `r round(overall_perf[overall_perf$model == "t.test", ]$sd.RMSE, 0)`) and interval score (mean = `r round(overall_perf[overall_perf$model == "t.test", ]$m.IS, 0)`, SD = `r round(overall_perf[overall_perf$model == "t.test", ]$sd.IS, 0)`)  between cGLMM and EHMOS, with bias as high as cGLMM, but negative (mean = `r round(overall_perf[overall_perf$model == "t.test", ]$m.bias, 0)`, SD = `r round(overall_perf[overall_perf$model == "t.test", ]$sd.bias, 0)`), and the smallest interval coverage of the three methods (mean = `r round(overall_perf[overall_perf$model == "t.test", ]$m.coverage, 2)`, SD = `r round(overall_perf[overall_perf$model == "t.test", ]$sd.coverage, 2)`). 

At the scenario level, EHMOS was still the most accurate method. It performed as well as cGLMM in scenarios with only middle species, i.e. scenarios including sub-scenario B1 (Fig. \ref{fig:fig2} upper panels), and was much more accurate than cGLMM in scenarios with edge species, i.e. scenarios including sub-scenario B2 (Fig. \ref{fig:fig2} lower panels). Averaging performance metrics for only edge species, we obtained an average RMSE almost three times larger for cGLMM than for EHMOS. cGLMM estimates of the quadratic effect of environment on species occurrence could be close to zero for edge species, yielding an unreliably high ratio of linear and quadratic coefficients, thus unreliable optimum and optimum shift estimates (Eq. \ref{shift_glmm}). Hence, on average for edge species, cGLMM had larger positive bias (`r round(perf_Topti[perf_Topti$model == "glmm" & perf_Topti$T_opti == "Edge",]$m.bias, 0)` m) and interval score (`r round(perf_Topti[perf_Topti$model == "glmm" & perf_Topti$T_opti == "Edge",]$m.IS, 0)`) compared to EHMOS (mean bias = `r round(perf_Topti[perf_Topti$model == "ehmos" & perf_Topti$T_opti == "Edge",]$m.bias, 0)` m; mean interval score = `r round(perf_Topti[perf_Topti$model == "ehmos" & perf_Topti$T_opti == "Edge",]$m.IS, 0)`).  


```{r fig2, fig.dim=c(8.3, 10.4), fig.cap = "Distribution of species specific performance metrics for the eight simulated scenarios after 30 replications. The colour of the points represents species optimum position along the simulated gradient  (in the edge, orange points, or in the middle, green points). Shape of points corresponds to species ecological specialization type relative to the width of their ecological niche (generalist species with broad ecological niche, represented by inverted triangles, or specialist species with narrower ecological niche, represented by circles)."}
fig2
```


The t-test method had comparable results to EHMOS in scenarios A1xB1xC1 and A1xB1xC2, with only slightly larger average RMSEs and interval score (Fig. \ref{fig:fig2}, Table \ref{tab:tab1}). For scenarios including edge species, i.e. scenarios including sub-scenario B2, there was only a slight difference in RMSEs between EHMOS and the t-test method (Fig. \ref{fig:fig2}). However, the t-test method, in scenarios with edge species, had on average negative bias that was at least two times larger than EHMOS bias (Fig. \ref{fig:fig2}). The t-test method also had poorer interval metrics than EHMOS, with interval coverage never reaching the expected threshold of 95\%, in contrast to EHMOS, which always reached this threshold (Fig. \ref{fig:fig2}), and with interval scores 30\% to 150\% larger than EHMOS in scenarios with edge species (Table \ref{tab:tab1}). The t-test method also resulted in poorer performance than EHMOS in scenarios with unbalanced sampling design (sub-scenario A2), with negative bias, smaller interval coverage and larger interval score (Fig. \ref{fig:fig2}, Table \ref{tab:tab1}). Differences between the EHMOS and t-test method performances in scenarios with unbalanced sampling design were exacerbated by the presence of generalist species (scenario A2xB1xC2 and A2xB2xC2 in Fig. \ref{fig:fig2} and Table \ref{tab:tab1}). The t-test had a high average negative bias of `r round(perf_scenario[perf_scenario$model == "t.test" & perf_scenario$scenario == "A2xB1xC2",]$m.bias, 0)` m and `r round(perf_scenario[perf_scenario$model == "t.test" & perf_scenario$scenario == "A2xB2xC2",]$m.bias, 0)` m, small average interval coverage of `r round(perf_scenario[perf_scenario$model == "t.test" & perf_scenario$scenario == "A2xB1xC2",]$m.coverage*100, 0)`\% and `r round(perf_scenario[perf_scenario$model == "t.test" & perf_scenario$scenario == "A2xB2xC2",]$m.coverage*100, 0)`\%, and large interval scores of `r round(perf_scenario[perf_scenario$model == "t.test" & perf_scenario$scenario == "A2xB1xC2",]$m.IS, 0)` and `r round(perf_scenario[perf_scenario$model == "t.test" & perf_scenario$scenario == "A2xB2xC2",]$m.IS, 0)` in scenarios A2xB1xC2 and A2xB2xC2. In comparison, EHMOS is relatively unbiased, with an average bias of `r round(perf_scenario[perf_scenario$model == "ehmos" & perf_scenario$scenario == "A2xB1xC2",]$m.bias, 0)` m and `r round(perf_scenario[perf_scenario$model == "ehmos" & perf_scenario$scenario == "A2xB2xC2",]$m.bias, 0)` m, had average interval coverage superior to 95\% for both scenarios, and had smaller interval scores: `r round(perf_scenario[perf_scenario$model == "ehmos" & perf_scenario$scenario == "A2xB1xC2",]$m.IS, 0)` and `r round(perf_scenario[perf_scenario$model == "ehmos" & perf_scenario$scenario == "A2xB2xC2",]$m.IS, 0)` for scenarios A2xB1xC2 and A2xB2xC2 respectively.

```{r tab1}

tab1 %>%
  kableExtra::kable(format = "latex",
        caption = "Average species specific interval scores for the eight simulated scenarios after 30 replications. Numbers in brackets represent standard deviations. ", 
        booktabs = T,
        position = 'H') %>%
  kableExtra::pack_rows("Uniform sampling", 1, 4) %>%
  kableExtra::pack_rows("Unbalanced sampling", 5, 8)

```

### Application

On average, species shifted upslope (Fig. \ref{fig:fig3}), with the mean shift ranging from `r appli_mean_shift[appli_mean_shift$model == "ttest", ]$m.shift %>% round(0)` m (SD = `r appli_mean_shift[appli_mean_shift$model == "ttest", ]$sd.shift %>% round(0)` m) and `r appli_mean_shift[appli_mean_shift$model == "glmm", ]$m.shift %>% round(0)` m (SD = `r appli_mean_shift[appli_mean_shift$model == "glmm", ]$sd.shift %>% round(0)` m) to `r appli_mean_shift[appli_mean_shift$model == "ehmos", ]$m.shift %>% round(0)` m (SD = `r appli_mean_shift[appli_mean_shift$model == "ehmos", ]$sd.shift %>% round(0)` m) based on the estimates from the t-test, cGLMM and EHMOS respectively. All significant shifts were upslope for the three methods, with 11, 8 and 10 species having significant shifts based respectively on EHMOS, cGLMM and t-test credible or confidence intervals. However, we observed heterogeneity between species, with estimated shifts ranging from 19 m (*Stauroderus scalaris*) to 344 m (*Bicolorana bicolor*) based on EHMOS, -124 m (*Platycleis albopunctata*) to 419 m (*Omocestus harmorrhoidalis*) based on cGLMM estimates and, -30 m (*Platycleis albopunctata*) to 356 m (*Bicolorana bicolor*) based on t-test results.

The three methods provided heterogeneous shift estimates (Fig. \ref{fig:fig3}). T-test estimates seemed to be smaller than those estimated by cGLMM or EHMOS. To verify this observation, we performed a paired t-test on species point estimates between methods. We found significant differences between the t-test and cGLMM estimates (mean difference = `r round(appli_ttest.vs.glmm$estimate, 0)`, t(`r appli_ttest.vs.glmm$parameter`) = `r round(appli_ttest.vs.glmm$statistic, 2)`, p = `r round(appli_ttest.vs.glmm$p.value, 2)`) and EHMOS estimates (mean difference = `r round(appli_ttest.vs.ehmos$estimate, 0)`, t(`r appli_ttest.vs.ehmos$parameter`) = `r round(appli_ttest.vs.ehmos$statistic, 2)`, p < 0.01), confirming our visual observation. Methods also differed in the precision of estimates. The t-test had on average narrower confidence intervals with a mean confidence interval width of `r appli_mean_CI.shift[appli_mean_CI.shift$model == "ttest", ]$m.CI.shift %>% round(0) ` m, compared to EHMOS (`r appli_mean_CI.shift[appli_mean_CI.shift$model == "ehmos", ]$m.CI.shift %>% round(0) ` m) and cGLMM (`r appli_mean_CI.shift[appli_mean_CI.shift$model == "glmm", ]$m.CI.shift %>% round(0) ` m). This high value for cGLMM is due to unreliably wide credible intervals for nine species (Fig. \ref{fig:fig3}). Those unrealistic estimates could be explained by quadratic coefficients, the denominator in optimum formulae (Eq. \ref{shift_glmm}), estimated close to zero and generating unreliable optimum estimates and thus shift estimates. This seemed to occur for taxa having their optimum close to the sampling edge (before the 10^th^ or beyond the 90^th^ percentile of the sampling site elevations, depicted as orange rectangles in Fig. \ref{fig:fig3}), for example,  *Yersinella sp.* and *Gomphocerus sibiricus sibiricus*, or species having low maximum occupancy probability, e.g. *Omocestus haemorrhoidalis*.

```{r fig3, fig.dim=c(8.3,7), fig.cap="Shift estimates following three statistical methods on 24 Orthoptera species optimum positions between 1980–1988 and 2018–2019 along an elevational gradient in Mercantour National Park (French Alps). The points correspond to the mean estimates and the segments to the associated 95\\% credible or confidence intervals. The black horizontal lines represent graphical range, segments reaching those lines indicate intervals wider than the graphical range. Species are ordered by increasing optimum estimates of the first period. Species names are coloured depending on the optimum position types with edge species coloured in orange and middle species in green. Presence (or absence) of asterisk indicates species ecological type as defined in the simulation study (presence: generalist, absence: specialist)."}

fig3

```

## Discussion

In this study, we performed simulations to test the accuracy of optimum shift estimates of a new model, the Explicit Hierarchical Model of Optimum Shifts (EHMOS), compared to a more standard GLMM and method based on the comparison of the mean. The simulation study provides evidence that EHMOS generally performed better than the two other methods. cGLMM performed identically to EHMOS when species had their optimum in the middle of the sampling gradient, but was inaccurate and very imprecise when some species had their optimum close to the sampling limits. We also found that the mean comparison method tended to be negatively biased, with low interval coverage in scenarios involving edge species or unbalanced sampling design, especially when generalist species were included. The case study confirmed that the three methods provide different results. cGLMM provided unreliable estimates for nine of the 24 Orthoptera species, and the mean comparison method had on average smaller shift estimates than the other two methods. On average, we found that species had shifted upslope by `r appli_mean_shift[appli_mean_shift$model == "ttest", ]$m.shift %>% round(0)` m (SD = `r appli_mean_shift[appli_mean_shift$model == "ttest", ]$sd.shift %>% round(0)` m) and `r appli_mean_shift[appli_mean_shift$model == "glmm", ]$m.shift %>% round(0)` m (SD = `r appli_mean_shift[appli_mean_shift$model == "glmm", ]$sd.shift %>% round(0)` m) to `r appli_mean_shift[appli_mean_shift$model == "ehmos", ]$m.shift %>% round(0)` m (SD = `r appli_mean_shift[appli_mean_shift$model == "ehmos", ]$sd.shift %>% round(0)` m) based on estimates from the t-test, cGLMM and EHMOS respectively.

EHMOS always performed better than the t-test-based method. Differences between these two methods were particularly large under unbalanced sampling design, especially in the presence of generalist species. It is predictable that mean estimates are biased by unbalanced sampling designs, in particular in scenarios where a part of the gradient is preferentially sampled [@terbraak1986]. We simulated one example where the middle part of the gradient was preferentially sampled, but similar results are expected in other preferential sampling design. In such situations, both optima estimates could be biased towards the preferentially sampled part of the gradient and shift estimates could be biased towards zero. This explains the negative bias produced by t-test method in simulations involving unbalanced sampling design. It is also not surprising that bias due to unbalanced sampling design is larger for generalist species than for specialist species. Bias is more influenced by the distribution of sampling sites occupied by the species rather than by the entire distribution of sampling sites. Occupied sites of a specialist species with a narrow range could be uniformly distributed even if the entire distribution of sampling sites is uneven. In contrast, the larger the species range, the more the occupied site distribution on the gradient will match the entire sampling site distribution, leading to biased shift estimates.

A slightly larger bias with the t-test than with EHMOS was also observed in scenarios involving edge species, even with balanced sampling. This could be explained by the sensitivity of t-tests to species response curve truncation [@terbraak1986]. In this case, the species–environment relationship is only partially observed, and the optimum is underestimated as the species range is not entirely covered [@terbraak1986]. Bias will thus increase with the magnitude of truncation. Hence, edge species that shifted towards the sampling range margins will have their second optimum more severely biased than the first, inducing underestimation in the shift estimates. Such a bias that depends on the species type could lead to misleading conclusions when comparing magnitudes of shifts between species types. Previous studies found that edge species shifted less than middle species [@rumpf2018]. While this finding is ecologically consistent, it could have been exacerbated by the bias associated to the use of the mean comparison method.  

Generalized linear models have been extensively used in species distribution modelling [@elith2010], and in optimum shift modelling [e.g. @coudun2005; @lenoir2008]. Usually, multiple GLMs are conducted separately for each species and each survey that is to be compared [but see @lembrechts2017]. This  approach has the inconvenient of losing information and thus precision in estimation by splitting the data into multiple data sets. Estimates for data-poor species may be improved with a GLMM, by borrowing information from data-rich species [@ovaskainen2011]. Hence, one could assume that GLM would have, at best equal and probably worse performances than cGLMM.  We thus chose to compare EHMOS only with cGLMM to show that EHMOS has advantages against classical GLM-based approaches. Our Bayesian framework allows us to derive uncertainty measures associated with shift estimates. It would have been possible to compute the asymptotic variance of optima or shift estimates using a frequentist approach, e.g. the delta method [@serfling1980;@billingsley1986]. The Bayesian GLMM we developed performed as well as the EHMOS and better than the mean comparison method in scenarios where all species have optima in the middle of the sampling range. However, as expected, for edge species, the standard GLMM failed to estimate bell shape curves, fitting sigmoid curves instead and making derived optima and shifts unreliable [@citores2020; @terbraak1986]. In contrast, EHMOS, thanks to its ecological formulation and explicit modelling of optimum shifts, allowed estimates of optimum shifts for edge species. Hence, edge species could be kept if one is using EHMOS, while they should be removed in t-test or GLM-based analysis. Ecological formulation of EHMOS, especially explicit modelling of shift, also allows easier choice of prior in a Bayesian setting. cGLMM parameters should be transformed to be ecologically interpretable (see Appendix S1). Such a transformation may change an uninformative prior on the parameter scale into an informative prior on the ecological scale, making the choice of prior complicated [see @lemoine2019 for an example in logistic regression]. Hence, the standard GLMM appeared to be less flexible than EHMOS. 

In addition to having more robust point estimate accuracy whatever the sampling design, ecological marginality and specialization than a t-test or cGLMM, EHMOS also seemed to produce more precise estimates. cGLMM was very sensitive to marginality in terms of precision, providing very wide and uninformative credible intervals for edge species. The interval coverage of the t-test was also very sensitive to marginality, sampling design and specialization. Having informative precision estimates is important when studying species shifts [@bates2015; @taheri2021]. Some authors use the overlap of confidence intervals as a surrogate for a test of significant difference [@lenoir2008; @urli2014], so low interval coverage could lead to misleading conclusions, and the t-test method should be avoided. 

Here, we studied optimum shifts between two surveys conducted 30 years apart of 24 Orthoptera species along an elevational gradient in the Alps. All methods suggested that on average Orthoptera species shifted their optimum towards higher elevations, and that the magnitude of the shift varies between species. These results are consistent with previous findings on other insect taxa, which on average have shifted upslope, but at different paces depending on the species [@vitasse2021]. Even if the magnitude of shifts varied between methods, our estimates are in line with the estimated warming rate of 0.36 $^{\circ}$C.decade^-1^ in the Alps between 1970 and 2019, which roughly corresponds to a mean shift of about +62–71 m decade^–1^ (Vitasse et al. 2021), leading to an expected mean shift of around +186–213 m between the two surveys. Thus, the average shift estimated by EHMOS (`r appli_mean_shift[appli_mean_shift$model == "ehmos", ]$m.shift %>% round(0)` m) is closer to what is expected than the t-test, suggesting it may provide a more reliable estimate of optimum shift. Yet this observation has to be taken carefully, as the warming rate could vary between regions, and species might respond at a slower rate than expected [@vitasse2021]. However, as the case study is close to the simulated scenario including the presence of both generalist and edge species sampled with an unbalanced sampling design, we could suspect an underestimation of optimum shifts by the t-test. It was also not surprising to obtain unreliable credible intervals for most of the edge species with the GLMM, as in the simulations.

Notwithstanding its demonstrated comparative advantages, EHMOS could have some limitations. It might produce optimum estimates outside the sampling range and thus, depending on the sampling design, outside the environmental range. This property could be an advantage in the case of niche truncation. However, optimum estimates should be limited to the environmental range: for example, by imposing an appropriate prior. One potential other limitation, also valid for cGLMM, is the assumption that species response curves are symmetric. While this assumption could stand for numerous species [@rydgren2003], some species could have asymmetrical relationships with environment gradients [@oksanen2002]. We found through simulations that the three methods could be biased in presence of asymmetrical species response curves (see Appendix S4). More precisely, the three methods provided biased optimum shift estimates when species response curves changed of shapes between the sampling occasions. For instance, the three methods produced positively biased optimum shift estimates for species having a symmetrical response curve in the first sampling occasion and a right-skewed species response curve in the second sampling occasion. In contrast, optimum shift should be accurately estimated by the three methods for species having the same degree of skewness in both sampling occasions. Hence, shape of species response curves should be inspected carefully prior to analysis. In case where response curves are asymmetric, some alternative modelling methods have been proposed, such as generalized additive models [GAM, e.g. @heegaard2002] or Huisman-Olff-Fresco approach [HOF, e.g. @oksanen2002], and applied in optimum shift modelling [@maggini2011; @urli2014]. However, previous simulation studies have shown that both methods could fail to retrieve the shape of species response [@jansen2013; @michaelis2017]. Both methods appeared to be sensitive to gradient truncation and sampling intensity [@jansen2013; @citores2020], limiting their use in unbalanced sampling design and for edge species. Further research is needed to find more robust methods to deal with asymmetrical response curves. Finally, we present the EHMOS within a hierarchical model that did not incorporate observation process. Imperfect detection could bias occupancy estimates, and this should be addressed in modelling whenever it is possible. While our example does not allow the use of multi-species occupancy models, hierarchical linear models estimating both species occupancy and detection [@dorazio2005], due to the absence of sampling replication in historical data, it is straightforward to extend our framework in a MSOM by adding the observation process in the hierarchy of the model.

EHMOS presents some advantages and potential extensions that we did not explore through our simulation analysis that may be interesting for future research. Its explicit formulation of optimum shifts allows direct testing of ecological assumptions about inter-specific variability: for example, about species traits' effects on the magnitude of shifts. Species trait effects could be added in the model through the random effect specification of shift [@jamil2014]. The potential effects of species ecological marginality or ecological specialization on magnitude of shift could also be tested by adding the correlation between optimum and shift, or tolerance and shift parameters respectively. Finally, while we focused on the particular case of sampling the same sites at two sampling occasions, we assumed that EHMOS would perform equally in the case of different sites sampled at each sampling occasion. It could also be easily extended to deal with more than two sampling occasions, and test for changes in rates of optimum shifts between multiple sampling occasions. EHMOS thus appears a highly flexible method that could be used in various fields.

## Data availability
The data and R scripts used to produce this manuscript will be available on GitHub and archived on Zenodo before publication.

## References
<div id="refs"></div>

## Biosketch
**Bastien Mourguiart** main research focus is on modelling species distributions. He is particularly interested in quantifying and explaining species responses to environmental changes. This work is part of his Ph.D. work at the University of Pau. He and the other authors collaborate to study Orthoptera altitudinal distributions and their determinants.

Authors' contribution statement: B.M., B.L. and A.B. conceived the ideas for this paper; B.M. wrote the manuscript and conducted the analyses with advice from B.L., K.M. and A.B.; T.C., J.M., Y.B. and A.B. conceived the sampling design and Y.B. collected field data with support from T.C. and J.M.; All the authors read and approved the final manuscript. 
