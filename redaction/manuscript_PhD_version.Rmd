---
title: "A new method to explicitly estimate the shift of optimum along gradients in multispecies studies"
subtitle: "Running title: Modelling of gradient optimum shifts"
classoption: a4paper
geometry: "left=3.8cm,right=2.5cm,top=2.5cm,bottom=2.5cm"
output:
  pdf_document:
    keep_tex: true
  word_document: default
  documentclass: article
fontsize: 12pt
header-includes:
- \usepackage{float}
- \usepackage{lscape}
- \usepackage{amsmath}
- \usepackage{nopageno}
- \usepackage{caption}
- \usepackage{setspace}\setstretch{1.5}
csl: journal-of-biogeography.csl
bibliography: Paper_EHMOS_cut.bib
---

Bastien Mourguiart$^{1*}$, Benoit Liquet$^{1,2}$, Kerrie Mengersen$^{1,3}$, Thibaut Couturier$^4$, Jérôme Mansons$^5$, Yoan Braud$^6$, Aurélien Besnard$^4$ 

$^1$ Laboratoire de Mathématiques et de leurs Applications, Université de Pau et des Pays de l'Adour, E2S UPPA, CNRS, Anglet, France  
$^2$ Department of Mathematics and Statistics, Macquarie University, Sydney, NSW 2109, Australia  
$^3$ ARC Centre of Excellence for Mathematical and Statistical Frontiers, School of Mathematical Science, Queensland University of Technology, Brisbane, QLD 4072, Australia  
$^4$ CEFE, Univ Montpellier, CNRS, EPHE-PSL University, IRD, Univ Paul Valéry Montpellier 3, Montpellier, France  
$^5$ Parc National du Mercantour, Nice, France  
$^6$ Bureau d'études Entomia, Vaumeilh, France  
 
\newpage


```{r setup2, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# set chunk default options for the document
knitr::opts_chunk$set(echo=FALSE, 
                      message=FALSE, 
                      warning=FALSE, 
                      fig.pos = 'H',
                      fig.align = 'center',
                      tab.pos = 'H')
```

```{r library, message=FALSE, warning=FALSE, include=FALSE}
library(bookdown)
library(knitr)
source(here::here("make.R"))
```

## Abstract
### Aim
Optimum shifts in species–environment relationships are intensively studied in a wide range of ecological topics, including climate change and species invasion. Numerous statistical methods are used to study optimum shifts but, to our knowledge, none explicitly estimate it. We extended an existing model to explicitly estimate optimum shifts for multiple species. We called this new Bayesian hierarchical model the Explicit Hierarchical Model of Optimum Shifts (EHMOS). 

### Location
All locations

### Taxon
All taxa

### Methods
In a simulation study, we compared the accuracy of EHMOS to a mean comparison method and a Bayesian generalized linear mixed model (GLMM). Specifically, we tested if the accuracy of the methods was sensitive to (1) sampling design, (2) species optimum position, and (3) species ecological specialization. In addition, we compared the three methods using a real dataset of investigated optimum shifts in 24 Orthopteran species between two time periods along an elevation gradient.

### Results
Of all the simulated scenarios, EHMOS was the most accurate method. GLMM was the most sensitive method to species optimum position, providing unreliable estimates in the presence of marginal species, i.e. species with an optimum close to a sampling boundary. The mean comparison method was also sensitive to species optimum position and ecological specialization, especially in an unbalanced sampling design, with high negative bias and low interval coverage compared to EHMOS. 
The case study results obtained with EHMOS were consistent with what is expected considering ongoing climate change, with mostly upward shifts, which further improved confidence in the accuracy of the EHMOS method.

### Main conclusions
Our findings indicate that EHMOS could be used for a wide range of topics and extended to produce new insights, especially in climate change studies. Explicit estimation of optimum shifts notably allows investigation of ecological assumptions that could explain interspecific variability of these shifts.


**Keywords:** Bayesian hierarchical modelling, Generalized Linear Mixed Model (GLMM), mean comparison method, optimum shift, sampling design, species distribution, species ecological specialization, species response curve  

## Introduction

Understanding changes in relationships between species and environmental, geographical or temporal gradients is of central interest in biogeography. For instance, assessing changes in species distribution along latitudinal [@thorson2016], elevational [@maggini2011] or climatic [@tayleur2015] gradients in response to ongoing climate change is crucial for developing relevant biodiversity change scenarios [@taheri2021] and predicting its impact on ecosystem health and human well-being [@pecl2017]. Modelling these changes is also central in the study of invasive species to predict the area of potential colonization [@elith2010]. The shifts in species phenology, i.e. changes along a temporal gradient, in response to climate change are also well-studied to obtain a mechanistic understanding of climate change impacts on species distributions [@moussus2010; @vitasse2021; @strebel2014].  

All this research aims at modelling the relationship between species characteristics –  such as occurrence probability [@maggini2011], abundance [@thorson2016] or singing activity [@strebel2014] – and linear covariates describing the studied gradient. These modelled relationships, often named "species response curves" [@tayleur2015], are usually unimodal curves [@oksanen2002]. They are characterized by a width, a maximum, an optimum (i.e. the value on the gradient where the maximum abundance or occurrence probability of the species is reached), and a lower and upper limit.  Changes in the relationship could then occur in each of these parameters, providing different and complementary information on the way species are affected by change over the gradient. However, these changes may be difficult to estimate. Changes in width or range limits of the species response curve may for instance be more difficult to estimate than optimum shifts due to sampling design or detectability issues linked to lower abundance near range limits [@shoo2006]. Hence, studying optimum shifts is often favoured over shifts at range limits to disentangle ecological changes from potential sampling artifacts [@shoo2006; @moussus2010; @lenoir2008].

Different modelling frameworks have been developed to study optimum shifts. The simplest, and probably the most widely used, is the mean comparison method [e.g. @shoo2006; @freeman2018], also known as the weighted average method [@terbraak1986; @thorson2016], in which mean values of occupied sites on the gradient are compared between two or more samples. However, such optimum estimates could be biased when sampling effort is uneven along the gradient [@shoo2006; @terbraak1986]. Such uneven sampling is common in ecology [@shoo2006; @rumpf2018], especially in cases of sampling difficult-to-access terrains such as mountains. Designing a random sample of a species distribution requires knowing the species distribution prior to sampling it, which is almost never the case. Regression methods, such as generalized linear models (GLMs), are also commonly used to estimate optimum shifts [@urli2014; @coudun2005; @lenoir2008] and are known to be more robust to unbalanced sampling design [@terbraak1986]. In this approach, two regressions are conducted to estimate the species optimum for each sample separately [@coudun2005]. Shift is then calculated as the difference between the two estimated optima [as in @lenoir2008]. Such a separate analysis makes it difficult to estimate uncertainty around the shift, so this uncertainty is often omitted [e.g. @lembrechts2017; @urli2014]. This absence of uncertainty is particularly prejudicial when post-hoc tests are performed on shift point estimates [@felde2012]. This approach also raises issues for species with an optimum close to the edge of the sampled gradient, hereafter referred to as edge species, also called marginal species [@hernandez2006]. In these cases, the regression follows a logistic relationship and does not provide an optimum [@citores2020]. As a consequence, such edge species are usually withdrawn from analysis [e.g. @rumpf2018; @felde2012]; however, they may be particularly sensitive to changes as they are limited by certain constraints (physiological, environmental, etc.) and subject to extirpation phenomenon, i.e. local extinctions caused by a lack of remaining suitable areas [@freeman2018]. Moreover, estimates of the mean shift at the community level could be biased by the removal of edge species, as the optimum shift could depend on the position along the gradient [@rumpf2018]. A model robust to unbalanced sampling design, providing estimates of uncertainties and including all species whatever the location of their optimum would be a substantial improvement for modelling shift in optima.

We developed an extension of the Gaussian logistic model [@jamil2014; @terbraak1986] that explicitly estimates shifts in optima for several species simultaneously, with their uncertainties. We also fitted a Bayesian Generalized Linear Mixed Model to simultaneously analyse both sampling occasions and all species and use the posterior distributions of the estimated coefficients to compute posterior distributions of species optimum shifts. The performance of these models was evaluated and compared to the estimates provided by a simple mean comparison method. The comparison was undertaken through a simulation study involving different sampling designs and ecological scenarios. The primary goal of the simulation study was to determine if the tested methods accurately estimate the optimum shifts of multiple species along a virtual environmental gradient. Specifically, we tested if the accuracy of the methods was sensitive to (1) sampling design, i.e. how sampling sites are distributed along the gradient, (2) species marginality, i.e. the location of the species optimum on the gradient, and (3) species ecological specialization, i.e. the width of the species–environment relationship. We finally applied the three methods to 24 Orthoptera species sampled twice 30 years apart in the French Alps along an elevation gradient.

## Materials and methods

### Shift modelling

We used a mean comparison method based on the Student t-test (hereafter, t-test) that compares species' average positions along a gradient between two sampling occasions, e.g. two periods or two regions. In this approach, species' optima are estimated as the mean of environmental values at which the species have been observed. We performed unpaired two-sample Student t-tests between surveys for each species separately. This provided species-specific shift estimates and associated confidence intervals.

We developed and fitted two hierarchical models: a 'classic' Generalized Linear Mixed Model (hereafter, cGLMM) and a new Explicit Hierarchical Model of Optimum Shifts (EHMOS). Both models assumed that the occurrence state (present or absent) observed for species $i$ at site $j$ during sampling occasion $k$, $Y_{i,j,k}$, relies on the probability $\psi_{i,j,k}$ that species $i$ can occupy site $j$ during sampling occasion $k$. In both models, we described the observation data as an outcome of a Bernoulli trial:

$$ Y_{i,j,k} \sim \text{Bernoulli}(\psi_{i,j,k}). $$

We assumed that species occupancy probability is related to the gradient through a symmetric bell-shaped curve, with an optimum where the maximum occupancy probability is reached. However, the two models differ in the formulation of the species–environment relationship. cGLMM allows five shapes of species-environment relationships (flat, monotone, 'plateau', U-shaped or bell-shaped unimodal symmetric response curves) some of which could be ecologically meaningless (e.g. U-shaped curves). EHMOS by its ecological formulation models only symmetric unimodal response curves. However, note that if EHMOS estimates optimum outside the sampling range, then the estimated SRC will look like a monotone or a 'plateau' relationship. EHMOS ecological formulation also allows direct interpretation of its model coefficients, especially about optimum and shift values. Note that both models assumed that unimodal species response curves are symmetrical, i.e. occupancy probabilities decrease at the same rate on both sides of the optimum. We discuss this potential limitation further in the manuscript.

*Classic Generalized Linear Mixed Model (cGLMM)* – The occupancy probability was modelled on the logit scale as a regression of linear and quadratic effects of environment. To allow for species-specific occurrence relationships with the gradient, we added a random intercept and random slope effects for the species ID. Changes in species distribution along the gradient between sampling occasions were assessed including a binary covariate, $S_k$, taking the value of 0 for one sampling occasion and 1 for the other, and its interaction with the linear and quadratic effects of the environment. As the same sites were included in the two samples, we added a random intercept term for the site ID, $\gamma^{site}_j \sim N(0, \sigma_{\gamma}^2)$, to account for data dependencies. Hence, in our cGLMM the occupancy model was formulated as follows:

  \begin{equation}
  logit(\psi_{i,j,k}) = \beta_{0i} + \beta_{1i} \times X_j + \beta_{2i} \times {X_j}^2 +
  \beta_{3i} \times S_k + \beta_{4i} \times S_k \times X_j + \beta_{5i} \times S_k \times {X_j}^2 + \gamma^{site}_j
  \label{glmm}
  \end{equation}
  
where $\beta_i$ represents the coefficients related to the species-specific effects mentioned above and $X_j$ is the value of the environmental variable at site $j$. Hence, $\beta_{0i}$, $\beta_{1i}$ and $\beta_{2i}$ describe the relationship between species occurrence and elevation during the first sampling for species $i$, while $\beta_{3i}$, $\beta_{4i}$ and $\beta_{5i}$ denote the changes in the species-specific occurrence–gradient relationship between the two sampling occasions. We calculated the species-specific optimum positions of each sampling occasion, denoted by $\theta_{i,k}$, from these regression coefficients [see Equation 2 in @terbraak1986]. We then calculated species shifts by subtracting optimum values of each sampling occasion as follows:

  \begin{align}
  \begin{split}
  \delta_i &= \theta_{i,2} - \theta_{i,1}  \\
  &= \frac{-(\beta_{1i}+\beta_{4i})}{2 \times (\beta_{2i}+\beta_{5i})} - \frac{-\beta_{1i}}{2 \times \beta_{2i}}
  \label{shift_glmm}
  \end{split}
  \end{align}
  
where $\delta_i$ is the optimum shift of species $i$.  

*Explicit Hierarchical Model of Optimum Shifts (EHMOS)* – We extended the multi-species Gaussian logistic model developed to describe species unique unimodal response curves [@jamil2014] to explicitly estimate shift in optimum positions between two sampling occasions. This model, we called Explicit Hierarchical Model of Optimum Shifts (EHMOS), describes multiple species–environment relationships simultaneously for two samples:

  \begin{equation}
  logit(\psi_{i,j,k}) = \alpha_{i,k} - \frac{[\text{X}_j - (\theta_{i} + (\text{S}_k \times \delta_{i}) )]^2}{2 \times {\tau_{i,k}}^2} +
  \gamma^{site}_j
  \label{eq_ehmos}
  \end{equation}
  
where $\alpha_{i,k}$ represents the maximum occupancy probability on the logit scale reached by species $i$ in sampling occasion $k$; $\theta_i$ is the environmental optimum of species $i$ for the first sampling occasion (as the binary variable $S_k$ is coded as $S_1 = 0$ and $S_2 = 1$); $\delta_i$ is the shift between the two optima for species $i$; $\tau_{i,k}$ is the species' ecological tolerance, a measure of the gradient portion length on which the species could occur (see Appendix S1 in Supporting Information).

In both models (Eq. (\ref{glmm}) and (\ref{eq_ehmos})), the gradient covariate was standardized to have a mean equal to zero and variance equal to one. Each species-specific parameter ($\Theta_i \in \{ \beta_i, \theta_i, \delta_i \}$) was modelled as a random species effect drawn from a normal distribution: $\Theta_i \sim N(\mu_{\Theta}, \sigma_{\Theta}^2)$ described by the community mean ($\mu_{\Theta}$) and the variance between species ($\sigma_{\Theta}^2$). Those community parameters are shared between the two sampling occasions for all the GLMM parameters ($\beta_i$'s), and for the optimum ($\theta_i$) and the shift ($\delta_i$) in the EHMOS model. For the species-specific and occasion-specific parameters $\alpha_{i,k}$ and $\tau_{i,k}$, the community means could vary between sampling occasions (e.g. $\tau_{i,k} \sim N(\mu_{\tau_k}, \sigma_{\tau}^2)$).

We implemented the two models in a Bayesian context. We then obtained posterior distributions for each species-specific parameter. Assuming a lack of prior knowledge of a parameter's true value, hyper-parameters were afforded default priors. We used wide normal priors (with mean 0 and variance 1000) for the means of community-level effects (the $\mu$'s) and inverse-gamma priors ($\text{Inv-gamma}(0.1, 0.1)$) for the community-level variances (the $\sigma^2$'s). In the cGLMM, we computed posterior distributions of the shifts from MCMC samples of the regression coefficients (Eq. (\ref{shift_glmm})). Hence, for both models we had posterior distributions for the species-specific shifts in optimum position. We used medians as point estimates and symmetric 95\% credible intervals as corresponding measures of uncertainty. Symmetric 95\% credible intervals were computed based on 0.025 and 0.975 quantiles of the MCMC posterior distributions.

We coded the two hierarchical Bayesian models in BUGS language and ran them in JAGS [@plummer2003], using the _jagsUI_ package [@kellner2021] in R software [@r2018]. The code is available on GitHub. We ran the analysis with the function `autojags()`, which updates the number of iterations within the burn-in phase until all parameters have a Gelman-Rubin statistic ($\hat{R}$) less than 1.1, suggesting satisfactory convergence [@gelman2013], or when the total number of iterations reached a maximum set at 250,000 iterations. We ran three MCMC chains with a thinning rate of 10 and with an initial burn-in phase of 15,000 iterations that was updated by 15,000 iterations until the specified convergence level was met or the maximum number of iterations was reached.

### Simulation study

We simulated the sampling of a community of 20 species during two sampling occasions at 300 sampling sites distributed along an elevational gradient ranging from 1000 m to 3000 m. We used two sampling design sub-scenarios: the distribution along the virtual elevation gradient of the sampling sites was either uniform, in sampling sub-scenario A1, or unbalanced, in sampling sub-scenario A2 (Fig. \ref{fig:fig1}a). In the unbalanced design, the simulated sampling sites followed a truncated normal distribution of mean 1970 m, standard-deviation 335 m restricted between 1000 m and 3000 m. We chose the mean and standard deviation according to those observed in the motivating example (see below).

We then positioned on the virtual gradient the optima of each species for the two virtual sampling occasions. We defined two optimum sub-scenarios (coded B1 and B2). In optimum sub-scenario B1, 100\% of species had both their optima in the middle of the sampling range, hereafter 'middle species' (green points in Fig. \ref{fig:fig1}b), while in B2 30\% of species (six species) were considered as 'edge species', i.e. had their optima close to the boundaries of the sampled gradient (red points in Fig. \ref{fig:fig1}b). We defined the middle of the sampling range as the part of the gradient that contains 80\% of the sampling sites (green areas in Fig. \ref{fig:fig1}ab), the upper and lower parts of the remaining sampling range were considered the sampling edges (orange areas in Fig. \ref{fig:fig1}ab). We simulated half of the optima of the edge species close to the upper edge, and the other half close to the lower edge. Simultaneously with the optimum of the first sampling occasion (full points in Fig. \ref{fig:fig1}b), we simulated the optimum shift, thus obtaining the second optimum (circles in Fig. \ref{fig:fig1}b), to respect percentages of edge and middle species in both sampling occasions. For all optimum sub-scenarios, we computed 60\% of upward shifts, 20\% of downward shifts and 20\% of no shift to test all kinds of response while keeping the majority of upward shifts as expected in conditions of ongoing climate change. The values of upward and downward shifts were sampled from a uniform distribution bounded between 80 m and 250 m, and ‑250 m and -80 m respectively.

We used two ecological specialization sub-scenarios (C1 and C2). In sub-scenario C1, we simulated only specialist species, i.e. species having a narrow ecological niche and high maximum occurrence probability (Fig. \ref{fig:fig1}c). In sub-scenario C2, we simulated 50\% of specialist and 50\% of generalist species having a wider ecological niche and lower maximum occurrence probability than specialist species (Fig. \ref{fig:fig1}c). We allowed for changes in shape parameters between sampling occasions in both sub-scenarios, but not in ecological specialization type: i.e. a generalist species remains a generalist species, but could have slightly different species response curves in the two sampling occasions. Niche width and maximum occurrence probability were sampled from uniform distributions, independently for the two sampling occasions, with the distribution parameters depending on the ecological specialization type. Specialist species had widths ranging from 400 m and 600 m, while generalists' width ranged between 1200 m and 1400 m. Maximum probability was set between 0.9 and 0.99 for specialist species, and between 0.75 and 0.85 for generalist species. These distribution parameter values were chosen to clearly separate the two types of species and match the values observed in the motivating example. 

We ran all possible combinations of the sub-scenarios, resulting in eight simulated scenarios. In each, we considered each species to have a symmetric unimodal response curve in both sampling occasions (Fig. \ref{fig:fig1}d). We produced site-specific probability of occupancy for each species in each scenario following:

$$logit(\psi_{i,j,k}^{s}) = \alpha_{i,k}^{s} - \frac{[\text{X}_j^{s} - (\theta_{i}^{s} + (\text{S}_k \times \delta_{i}^{s}) )]^2}{2 \times {\tau_{i,k}^{s}}^2}$$

with $\psi_{i,j,k}^{s}$ the occurrence probability of species $i$ at site $j$ during sampling occasion $k$ simulated in scenario $s$, $\text{X}_j^{s}$ is the value on the elevation gradient of site $j$ under scenario $s$, $\theta_{i}^{s}$ and $\delta_{i}^{s}$ are respectively the optimum and shift of species $i$ in scenario $s$, and $\alpha_{i,k}^{s}$ and $\tau_{i,k}^{s}$ are related to niche width and maximum probability of occupancy (see Appendix S1). Observed presence or absence of species $i$ at site $j$ during sampling occasion $k$ under scenario $s$, $Y_{i,j,k}^{s}$, was then drawn from a Benoulli distribution: $Y_{i,j,k}^{s} \sim Bernoulli(\psi_{i,j,k}^{s})$. We replicated the Bernoulli trials 30 times for each of the 8 scenarios, resulting in 240 simulated datasets.

```{r fig1, fig.cap="Example of the simulation process for two scenarios each broken down in three categories of sub-scenarios: (a) the sampling design either uniform (A1) or unbalanced (A2) (b) the optimum positions for the first (full points) and second (circles) sampling occasions of the 20 species, which is either in the middle (green area) or close to the edges (orange areas) of the sampling range in variable proportions depending on sub-scenario category (B1: 100\\% middle, B2: 70\\% middle) (c) the ecological specialization of species, which can be specialist (dark curves) or generalist species (purple curves) in variable proportions depending on the sub-scenario category (100\\% in C1 or 50\\% in C2 of specialist species). The bottom panel represents (d) the species response curves for the first and second sampling occasion (solid and dashed lines) of the two scenarios that results in the combination of the three sub-scenarios above.", fig.dim=c(8.3, 9.4)}

cowplot::plot_grid(g_subscenarA, g_subscenarB, g_subscenarC, g_scenar, 
                   nrow=4,
                   labels=c("(a)", "(b)","(c)","(d)"),
                   label_size = 12)
```


### Model performance assessment

We assessed estimation accuracy and precision through four metrics (i) bias, the difference between true and estimated absolute optimum shifts, (ii) root mean squared error, which combines bias and imprecision, (iii) interval coverage, i.e. the proportion of estimated credible/confidence intervals that contain the true optimum shifts, and (iv) interval score, which combines information on width of credible/confidence intervals and on interval coverage. Details on the calculation of the four metrics are provided in Appendix S2. We also compared the computing performance of the Bayesian models. We counted the number of times when at least one parameter failed to converge after the maximum of iterations was reached. Due to the number of runs and parameters, we just looked at the Gelman-Rubin statistic threshold of 1.1 [@gelman2013] and did not make visual diagnostics. We also computed the average running time for each model.

### Motivating example

Our goal when starting this study was to find an appropriate modelling approach that produces estimates, and associated uncertainties, of shifts in elevation optima of an Orthoptera community studied during two periods separated by 30 years. This study was conducted in 134 sampling sites distributed along an elevation gradient ranging from 928 m to 2614 m (mean = 1869 m) above sea level in Mercantour National Park in the southern French Alps. The first survey was carried out during the summers between 1983 and 1988 (Gueguen 1990). At each site, the density of Orthoptera species was assessed based on multiple counts made using box quadrats that trapped individuals. The second survey was conducted during the summers of 2018 and 2019. Each sampling site consisted of a circle with a 70-m radius where five spatial replicates (hereafter, plots) 30 m2 in area were surveyed following three successive steps: (1) one minute of listening to species stridulating in the plot by standing close to its edge, (2) six minutes of sighting species by walking across the entire plot, and (3) two 45-second sweep netting sessions across the entire plot [see @mourguiart2021 for a full description of the sampling design]. To minimize the effect of varying sampling effort and detection methods between surveys, we reduced the Orthoptera records to the presence/absence data at the site level and only kept species detected in at least 5\% of sampling sites. We pooled some species' data in a species complex when species confusion was possible. Thus, we aggregated data for species in the genuses *Yersinella*, *Calliptamus*, *Podisma* and in the complex *Chorthippus biggutulus-brunneus-mollis-daimei*. We fitted the three methods to the 24 taxa kept after data processing. 

## Results

Before analysing the results, we checked for convergence issues and running times of cGLMM and EHMOS. In the $\hat{R}$ statistics check, we observed that 50\% of runs failed to converge (at least one parameter had $\hat{R}$ higher than 1.1) for cGLMM (see in Appendix S3 as Table S3.1). Due to the running time, `r m.compute_time[m.compute_time$model == "glmm", ]$mean` hours (SD = `r m.compute_time[m.compute_time$model == "glmm", ]$SD` hours) on average for cGLMM (see in Appendix S3 as Table S3.2), we chose not to re-run more iterations of models that did not converge. All models converged for EHMOS and took on average `r m.compute_time[m.compute_time$model == "ehmos", ]$mean` hours (SD = `r m.compute_time[m.compute_time$model == "ehmos", ]$SD` hour) for this process (see in Appendix S3 as Table S3.2). In the motivating example, both models converged: EHMOS ran in `r round(out_appli_ehmos$mcmc.info$elapsed.mins, 0)` minutes and cGLMM in `r round(out_appli_glmm$mcmc.info$elapsed.mins, 0)` minutes.

### Simulation

Averaging performance metrics for all species in the eight scenarios, we found that EHMOS performed better than cGLMM and t-test whatever the performance metrics. EHMOS had the smallest average RMSE (mean = `r round(overall_perf[overall_perf$model == "ehmos", ]$m.RMSE, 0)`, SD = `r round(overall_perf[overall_perf$model == "ehmos", ]$sd.RMSE, 0)`), bias (mean = `r round(overall_perf[overall_perf$model == "ehmos", ]$m.bias, 0)`, SD = `r round(overall_perf[overall_perf$model == "ehmos", ]$sd.bias, 0)`), interval score (mean = `r round(overall_perf[overall_perf$model == "ehmos", ]$m.IS, 0)`, SD = `r round(overall_perf[overall_perf$model == "ehmos", ]$sd.IS, 0)`), and the largest interval coverage (mean = `r round(overall_perf[overall_perf$model == "ehmos", ]$m.coverage, 2)`, SD = `r round(overall_perf[overall_perf$model == "ehmos", ]$sd.coverage, 2)`). cGLMM had similar interval coverage to EHMOS (mean = `r round(overall_perf[overall_perf$model == "glmm", ]$m.coverage, 2)`, SD = `r round(overall_perf[overall_perf$model == "glmm", ]$sd.coverage, 2)`), but relatively high positive bias (mean = `r round(overall_perf[overall_perf$model == "glmm", ]$m.bias, 0)`, SD = `r round(overall_perf[overall_perf$model == "glmm", ]$sd.bias, 0)`), the largest RMSE of all three methods (mean = `r round(overall_perf[overall_perf$model == "glmm", ]$m.RMSE, 0)`, SD = `r round(overall_perf[overall_perf$model == "glmm", ]$sd.RMSE, 0)`), and interval score (mean = `r round(overall_perf[overall_perf$model == "glmm", ]$m.IS, 0)`, SD = `r round(overall_perf[overall_perf$model == "glmm", ]$sd.IS, 0)`). The t-test had an intermediate RMSE (mean = `r round(overall_perf[overall_perf$model == "t.test", ]$m.RMSE, 0)`, SD = `r round(overall_perf[overall_perf$model == "t.test", ]$sd.RMSE, 0)`) and interval score (mean = `r round(overall_perf[overall_perf$model == "t.test", ]$m.IS, 0)`, SD = `r round(overall_perf[overall_perf$model == "t.test", ]$sd.IS, 0)`)  between cGLMM and EHMOS, with bias as high as cGLMM, but negative (mean = `r round(overall_perf[overall_perf$model == "t.test", ]$m.bias, 0)`, SD = `r round(overall_perf[overall_perf$model == "t.test", ]$sd.bias, 0)`), and the smallest interval coverage of the three methods (mean = `r round(overall_perf[overall_perf$model == "t.test", ]$m.coverage, 2)`, SD = `r round(overall_perf[overall_perf$model == "t.test", ]$sd.coverage, 2)`). 

At the scenario level, EHMOS was still the most accurate method. It performed as well as cGLMM in scenarios with only middle species, i.e. scenarios including sub-scenario B1 (Fig. \ref{fig:fig2} upper panels), and was much more accurate than cGLMM in scenarios with edge species, i.e. scenarios including sub-scenario B2 (Fig. \ref{fig:fig2} lower panels). Averaging performance metrics for only edge species, we obtained an average RMSE almost three times larger for cGLMM than for EHMOS. cGLMM estimates of the quadratic effect of environment on species occurrence could be close to zero for edge species, yielding an unreliably high ratio of linear and quadratic coefficients, thus unreliable optimum and optimum shift estimates (Eq. \ref{shift_glmm}). Hence, on average for edge species, cGLMM had larger positive bias (`r round(perf_Topti[perf_Topti$model == "glmm" & perf_Topti$T_opti == "Edge",]$m.bias, 0)` m) and interval score (`r round(perf_Topti[perf_Topti$model == "glmm" & perf_Topti$T_opti == "Edge",]$m.IS, 0)`) compared to EHMOS (mean bias = `r round(perf_Topti[perf_Topti$model == "ehmos" & perf_Topti$T_opti == "Edge",]$m.bias, 0)` m; mean interval score = `r round(perf_Topti[perf_Topti$model == "ehmos" & perf_Topti$T_opti == "Edge",]$m.IS, 0)`).  


```{r fig2, fig.dim=c(8.3, 10.4), fig.cap = "Distribution of species specific performance metrics for the eight simulated scenarios after 30 replications. The colour of the points represents species optimum position along the simulated gradient  (in the edge, orange points, or in the middle, green points). Shape of points corresponds to species ecological specialization type relative to the width of their ecological niche (generalist species with broad ecological niche, represented by inverted triangles, or specialist species with narrower ecological niche, represented by circles)."}
fig2
```


The t-test method had comparable results to EHMOS in scenarios A1xB1xC1 and A1xB1xC2, with only slightly larger average RMSEs and interval score (Fig. \ref{fig:fig2}, Table \ref{tab:tab1}). For scenarios including edge species, i.e. scenarios including sub-scenario B2, there was only a slight difference in RMSEs between EHMOS and the t-test method (Fig. \ref{fig:fig2}). However, the t-test method, in scenarios with edge species, had on average negative bias that was at least two times larger than EHMOS bias (Fig. \ref{fig:fig2}). The t-test method also had poorer interval metrics than EHMOS, with interval coverage never reaching the expected threshold of 95\%, in contrast to EHMOS, which always reached this threshold (Fig. \ref{fig:fig2}), and with interval scores 30\% to 150\% larger than EHMOS in scenarios with edge species (Table \ref{tab:tab1}). The t-test method also resulted in poorer performance than EHMOS in scenarios with unbalanced sampling design (sub-scenario A2), with negative bias, smaller interval coverage and larger interval score (Fig. \ref{fig:fig2}, Table \ref{tab:tab1}). Differences between the EHMOS and t-test method performances in scenarios with unbalanced sampling design were exacerbated by the presence of generalist species (scenario A2xB1xC2 and A2xB2xC2 in Fig. \ref{fig:fig2} and Table \ref{tab:tab1}). The t-test had a high average negative bias of `r round(perf_scenario[perf_scenario$model == "t.test" & perf_scenario$scenario == "A2xB1xC2",]$m.bias, 0)` m and `r round(perf_scenario[perf_scenario$model == "t.test" & perf_scenario$scenario == "A2xB2xC2",]$m.bias, 0)` m, small average interval coverage of `r round(perf_scenario[perf_scenario$model == "t.test" & perf_scenario$scenario == "A2xB1xC2",]$m.coverage*100, 0)`\% and `r round(perf_scenario[perf_scenario$model == "t.test" & perf_scenario$scenario == "A2xB2xC2",]$m.coverage*100, 0)`\%, and large interval scores of `r round(perf_scenario[perf_scenario$model == "t.test" & perf_scenario$scenario == "A2xB1xC2",]$m.IS, 0)` and `r round(perf_scenario[perf_scenario$model == "t.test" & perf_scenario$scenario == "A2xB2xC2",]$m.IS, 0)` in scenarios A2xB1xC2 and A2xB2xC2. In comparison, EHMOS is relatively unbiased, with an average bias of `r round(perf_scenario[perf_scenario$model == "ehmos" & perf_scenario$scenario == "A2xB1xC2",]$m.bias, 0)` m and `r round(perf_scenario[perf_scenario$model == "ehmos" & perf_scenario$scenario == "A2xB2xC2",]$m.bias, 0)` m, had average interval coverage superior to 95\% for both scenarios, and had smaller interval scores: `r round(perf_scenario[perf_scenario$model == "ehmos" & perf_scenario$scenario == "A2xB1xC2",]$m.IS, 0)` and `r round(perf_scenario[perf_scenario$model == "ehmos" & perf_scenario$scenario == "A2xB2xC2",]$m.IS, 0)` for scenarios A2xB1xC2 and A2xB2xC2 respectively.

```{r tab1}

tab1 %>%
  kableExtra::kable(format = "latex",
        caption = "Average species specific interval scores for the eight simulated scenarios after 30 replications. Numbers in brackets represent standard deviations. ", 
        booktabs = T,
        position = 'H') %>%
  kableExtra::pack_rows("Uniform sampling", 1, 4) %>%
  kableExtra::pack_rows("Unbalanced sampling", 5, 8)

```

### Application

On average, species shifted upslope (Fig. \ref{fig:fig3}), with the mean shift ranging from `r appli_mean_shift[appli_mean_shift$model == "ttest", ]$m.shift %>% round(0)` m (SD = `r appli_mean_shift[appli_mean_shift$model == "ttest", ]$sd.shift %>% round(0)` m) and `r appli_mean_shift[appli_mean_shift$model == "glmm", ]$m.shift %>% round(0)` m (SD = `r appli_mean_shift[appli_mean_shift$model == "glmm", ]$sd.shift %>% round(0)` m) to `r appli_mean_shift[appli_mean_shift$model == "ehmos", ]$m.shift %>% round(0)` m (SD = `r appli_mean_shift[appli_mean_shift$model == "ehmos", ]$sd.shift %>% round(0)` m) based on the estimates from the t-test, cGLMM and EHMOS respectively. All significant shifts were upslope for the three methods, with 11, 8 and 10 species having significant shifts based respectively on EHMOS, cGLMM and t-test credible or confidence intervals. However, we observed heterogeneity between species, with estimated shifts ranging from 19 m (*Stauroderus scalaris*) to 344 m (*Bicolorana bicolor*) based on EHMOS, -124 m (*Platycleis albopunctata*) to 419 m (*Omocestus harmorrhoidalis*) based on cGLMM estimates and, -30 m (*Platycleis albopunctata*) to 356 m (*Bicolorana bicolor*) based on t-test results.

The three methods provided heterogeneous shift estimates (Fig. \ref{fig:fig3}). T-test estimates seemed to be smaller than those estimated by cGLMM or EHMOS. To verify this observation, we performed a paired t-test on species point estimates between methods. We found significant differences between the t-test and cGLMM estimates (mean difference = `r round(appli_ttest.vs.glmm$estimate, 0)`, t(`r appli_ttest.vs.glmm$parameter`) = `r round(appli_ttest.vs.glmm$statistic, 2)`, p = `r round(appli_ttest.vs.glmm$p.value, 2)`) and EHMOS estimates (mean difference = `r round(appli_ttest.vs.ehmos$estimate, 0)`, t(`r appli_ttest.vs.ehmos$parameter`) = `r round(appli_ttest.vs.ehmos$statistic, 2)`, p < 0.01), confirming our observation on the graph. Methods also differed in the precision of estimates. The t-test had on average narrower confidence intervals with a mean confidence interval width of `r appli_mean_CI.shift[appli_mean_CI.shift$model == "ttest", ]$m.CI.shift %>% round(0) ` m, compared to EHMOS (`r appli_mean_CI.shift[appli_mean_CI.shift$model == "ehmos", ]$m.CI.shift %>% round(0) ` m) and cGLMM (`r appli_mean_CI.shift[appli_mean_CI.shift$model == "glmm", ]$m.CI.shift %>% round(0) ` m). This high value for cGLMM is due to unreliably wide credible intervals for nine species (Fig. \ref{fig:fig3}). Those unrealistic estimates could be explained by quadratic coefficients, the denominator in optimum formulae (Eq. \ref{shift_glmm}), estimated close to zero and generating unreliable optimum estimates and thus shift estimates. This seemed to occur for taxa having their optimum close to the sampling edge (before the 10^th^ or beyond the 90^th^ percentile of the sampling site elevations, depicted as orange rectangles in Fig. \ref{fig:fig3}), for example,  *Yersinella sp.* and *Gomphocerus sibiricus sibiricus*, or species having low maximum occupancy probability, e.g. *Omocestus haemorrhoidalis*.

```{r fig3, fig.dim=c(8.3,7), fig.cap="Shift estimates following three statistical methods on 24 Orthoptera species optimum positions between 1980–1988 and 2018–2019 along an elevational gradient in Mercantour National Park (French Alps). The points correspond to the mean estimates and the segments to the associated 95\\% credible or confidence intervals. The black horizontal lines represent graphical range, segments reaching those lines indicate intervals wider than the graphical range. Species are ordered by increasing optimum estimates of the first period. Species names are coloured depending on the optimum position types with edge species coloured in orange and middle species in green. Presence (or absence) of asterisk indicates species ecological type as defined in the simulation study (presence: generalist, absence: specialist)."}

fig3

```

## Discussion

In this study, we performed simulations to test the accuracy of optimum shift estimates of a new model, the Explicit Hierarchical Model of Optimum Shifts (EHMOS), compared to a more standard GLMM and method based on the comparison of the mean. The simulation study provides evidence that EHMOS generally performed better than the two other methods. cGLMM performed identically to EHMOS when species had their optimum in the middle of the sampling gradient, but was inaccurate and very imprecise when some species had their optimum close to the sampling limits. We also found that the mean comparison method tended to be negatively biased, with low interval coverage in scenarios involving edge species or unbalanced sampling design, especially when generalist species were included. The case study confirmed that the three methods provide different results. cGLMM provided unreliable estimates for nine of the 24 Orthoptera species, and the mean comparison method had on average smaller shift estimates than the other two methods. On average, we found that species had shifted upslope by `r appli_mean_shift[appli_mean_shift$model == "ttest", ]$m.shift %>% round(0)` m (SD = `r appli_mean_shift[appli_mean_shift$model == "ttest", ]$sd.shift %>% round(0)` m) and `r appli_mean_shift[appli_mean_shift$model == "glmm", ]$m.shift %>% round(0)` m (SD = `r appli_mean_shift[appli_mean_shift$model == "glmm", ]$sd.shift %>% round(0)` m) to `r appli_mean_shift[appli_mean_shift$model == "ehmos", ]$m.shift %>% round(0)` m (SD = `r appli_mean_shift[appli_mean_shift$model == "ehmos", ]$sd.shift %>% round(0)` m) based on estimates from the t-test, cGLMM and EHMOS respectively.

EHMOS always performed better than the t-test-based method. Differences between these two methods were particularly large under unbalanced sampling design, and especially in the presence of generalist species. It is predictable that mean estimates are biased by unbalanced sampling designs, in particular in scenarios where a part of the gradient is preferentially sampled leading to bias in optimum estimates towards this part [@terbraak1986]. We simulated one example where the middle part of the gradient was preferentially sampled, but similar results are expected in other preferential sampling design, e.g. preferential sampling towards low elevations due to the reduction in surface area with elevation [@lenoir2008]. In such situations, both optima estimates could be biased towards the preferentially sampled part of the gradient and shift estimates could be biased towards zero. This explains the negative bias produced by t-test method in our simulated scenarios involving unbalanced sampling design. It is also not surprising that bias due to unbalanced sampling design is larger for generalist species than for specialist species. Bias is more influenced by the distribution of sampling sites occupied by the species rather than by the entire distribution of sampling sites. Occupied sites of a specialist species with a narrow range could be uniformly distributed even if the entire distribution of sampling sites is uneven. In contrast, the larger the species range, the more the occupied site distribution on the gradient will match the entire sampling site distribution, leading to biased shift estimates.

A slightly larger bias with the t-test than with EHMOS was also observed in scenarios involving edge species, even with balanced sampling. This could be explained by the sensitivity of t-tests to species response curve truncation [@terbraak1986]. In this case, the species–environment relationship is only partially observed, and the optimum is underestimated as the species range is not entirely covered [@terbraak1986]. Bias will thus increase with the magnitude of truncation. Hence, edge species that shifted towards the sampling range margins will have their second optimum more severely biased than the first, inducing underestimation in the shift estimates. Such a bias that depends on the species type could lead to misleading conclusions when comparing magnitudes of shifts between species types. Previous studies found that edge species shifted less than middle species [@rumpf2018]. While this finding is ecologically consistent, it could have been exacerbated by the bias associated to the use of the mean comparison method.  

Generalized linear models have been extensively used in species distribution modelling [@elith2010], and also in optimum shift modelling [e.g. @coudun2005; @lenoir2008]. Usually, multiple GLMs are conducted separately for each species and each survey that is to be compared [but see @lembrechts2017 using GLMM]. This  approach has the inconvenient of losing information and thus precision in estimation by splitting the data into multiple data sets. Estimates for data-poor species may for instance be improved with a GLMM, by borrowing information from data-rich species [@ovaskainen2011]. Hence, one could assume that GLM would have, at best equal and probably worse performances than cGLMM.  We thus chose to compare EHMOS only with cGLMM to show that EHMOS has advantages against classical GLM-based approaches. We worked with a Bayesian framework that allows us to derive uncertainty measures associated with shift estimates. Note that it would have been possible to compute the asymptotic variance of optima or shift estimates using a frequentist approach, e.g. the delta method [@urli2014]. The Bayesian GLMM we developed here performed as well as the EHMOS and better than the mean comparison method in scenarios where all species have optima in the middle of the sampling range. However, as expected, for edge species, the standard GLMM failed to estimate bell shape curves, fitting sigmoid curves instead and making derived optima and shifts unreliable [@citores2020; @terbraak1986]. In contrast, EHMOS, thanks to its ecological formulation and its explicit modelling of optimum shifts, allowed estimates of optimum shifts for edge species. Hence, edge species could be kept if one is using EHMOS, while they should be removed in t-test or GLM-based analysis. Ecological formulation of EHMOS, especially explicit modelling of shift, will also allow easier choice of prior in a Bayesian setting. cGLMM parameters should be transformed to be ecologically interpretable (see Appendix S1). Such a transformation may change an uninformative prior on the parameter scale into an informative prior on the ecological scale, making the choice of prior more complicated [see @lemoine2019 for an example in logistic regression]. Hence, the standard GLMM appeared to be less flexible than EHMOS. 

In addition to having more robust point estimate accuracy whatever the sampling design, ecological marginality and specialization than a t-test or cGLMM, EHMOS also seemed to produce more precise estimates. cGLMM was very sensitive to ecological marginality in terms of precision, providing very wide and uninformative credible intervals for edge species. The interval coverage of the t-test was also very sensitive to ecological marginality, sampling design and ecological specialization. Having informative precision estimates and reporting them is important when studying species shifts [@bates2015; @taheri2021]. Some authors use the overlap of confidence intervals as a surrogate for a test of significant difference [@lenoir2008; @urli2014], so low interval coverage could lead to misleading conclusions, and the t-test method should be avoided. 

In our case study, we studied optimum shifts between two surveys conducted 30 years apart of 24 Orthoptera species along an elevational gradient in the French Alps. All methods suggested that on average Orthoptera species shifted their optimum towards higher elevations, and that the magnitude of the shift varies between species. These results are consistent with previous findings on other insect taxa, which on average have shifted upslope, but at different paces depending on the species [@vitasse2021]. Even if the magnitude of shifts varied between methods, our estimates are in line with the estimated warming rate of 0.36 $^{\circ}$C.decade^-1^ in the Alps between 1970 and 2019, which roughly corresponds to a mean shift of about +62–71 m decade^–1^ (Vitasse et al. 2021), leading to an expected mean shift of around +186–213 m between the two surveys. Thus, the average shift estimated by EHMOS (`r appli_mean_shift[appli_mean_shift$model == "ehmos", ]$m.shift %>% round(0)` m) is closer to what is expected than the t-test, suggesting it may provide a more reliable estimate of optimum shift. Yet this observation has to be taken carefully, as the warming rate could vary between regions, and species might respond at a slower rate than expected [@vitasse2021]. However, as the case study is close to the scenario A2xB2xC2 of our simulations, with the presence of both generalist and edge species sampled with an unbalanced sampling design, we could suspect an underestimation of optimum shifts by the t-test as observed in these simulations. It was also not surprising to obtain unreliable wide credible intervals for most of the edge species with the GLMM, as the simulations provide such evidence.

Notwithstanding its demonstrated comparative advantages, EHMOS could have some limitations. It might produce optimum estimates outside the sampling range and thus, depending on the sampling design, outside the environmental range. This property could be an advantage in the case of niche truncation. However, optimum estimates should be limited to the environmental range: for example, by imposing an appropriate prior. One potential other limitation, also valid for cGLMM, is the assumption that species response curves are symmetric. While this assumption could stand for numerous species [@rydgren2003], some species could have asymmetrical relationships with environment gradients [@oksanen2002]. We found through a simulation study that the three methods could be biased in presence of asymmetrical species response curves (see Appendix S4). More precisely, the three methods provided biased optimum shift estimates when species response curves changed of shapes between the sampling occasions. For instance, the three methods produced positively biased optimum shift estimates for species having a symmetrical response curve in the first sampling occasion and a right-skewed species response curve in the second sampling occasion,  situations that could arise due to range margin contraction or expansion for instance. In contrast, optimum shift should be accurately estimated by the three methods for species having the same degree of skewness in both sampling occasions. Hence, shape of species response curves should be inspected carefully prior to analysis. In case where response curves are asymmetric, some alternative modelling methods have been proposed, such as generalized additive models [GAM, e.g. @heegaard2002] or Huisman-Olff-Fresco approach [HOF, e.g. @oksanen2002], and applied in optimum shift modelling [@maggini2011; @urli2014]. However, previous simulation studies have shown that both methods could fail to retrieve the true shape of species response [@jansen2013; @michaelis2017]. Both methods appeared to be sensitive to gradient truncation and sampling intensity [@jansen2013; @citores2020], limiting their use in unbalanced sampling design and for edge species. Further research is thus needed to find more robust methods to detect and deal with asymmetrical response curves. Finally, we present the EHMOS within a hierarchical model that did not incorporate observation process. It is well known that imperfect detection could bias occupancy estimates, and that this should be addressed in modelling whenever it is possible. While our example does not allow the use of multi-species occupancy models, hierarchical linear models estimating both species occupancy and detection [@dorazio2005], due to the absence of sampling replication in historical data, it is straightforward to extend our framework in a MSOM by adding the observation process in the hierarchy of the model.

EHMOS presents some advantages and potential extensions that we did not explore through our simulation analysis that may be interesting for future research. Its explicit formulation of optimum shifts could allow direct testing of ecological assumptions about inter-specific variability: for example, assumptions about species traits that may affect the magnitude of shifts. Species trait effects could be added directly in the model through the random effect specification of shift [@jamil2014]. The potential effects of species ecological marginality or ecological specialization on magnitude of shift could also be tested by adding the correlation between optimum and shift, or tolerance and shift parameters respectively. Finally, while we focused on the particular case of sampling the same sites at two sampling occasions, we assumed that EHMOS would perform equally in the case of different sites sampled at each sampling occasion. It could also be easily extended to deal with more than two sampling occasions, and test for changes in rates of optimum shifts between multiple sampling occasions. EHMOS thus appears a highly flexible method that could be used in various fields.

## References
<div id="refs"></div>

\newpage
## Appendix S1: Description of EHMOS' parameters

In the occupancy model of EHMOS (see Eq. (3) in the main text), the four parameters ($\alpha$, $\theta$, $\delta$ and $\tau$) represent ecological descriptors of the species-environment relationship (Fig. S1):

* $\alpha$ corresponds to the maximum probability of occurrence, $\psi_{max}$, on the logit scale. Indeed, the maximum probability of occurrence is reached when gradient value is equal to the optimum, i.e. we have $\psi_j = \psi_{max}$ when $X_j = \theta$. Thus, Eq. (3) in the main text becomes: 

\begin{equation}
  log(\frac{\psi_{max}}{1-\psi_{max}}) = \alpha \iff \psi_{max}  =   \frac{1}{1+ \exp(-\alpha)};
\end{equation}


* $\theta$ is the species optimum, the environmental value at which species reached its maximum probability of occupancy;

* $\delta$ is the species shift between two optima;

* $\tau$ represents the environmental tolerance of a species, i.e. the gradient range that a species can occupy. It can be related to the width, $\omega$, of the species response curve at a specified occupancy probability threshold, $p_{\omega}$, by:

\begin{equation}
  \omega = 2 \times \tau \sqrt{2 \times (\alpha - logit(p_{\omega}))} \iff \tau = 0.5 \times  \frac{\omega}{\sqrt{2 \times (\alpha - logit(p_{\omega}))}}
\end{equation}
with a $p_{\omega}$ usually specified at 0.05 to estimate the suitable range of a species (Michaelis & Diekmann, 2017).

Those four EHMOS parameters can also be derived from cGLMM coefficient estimates (Jamil et al., 2014):

\begin{align*}
  \alpha &= \beta_0 - \frac{{\beta_1}^2}{4 \beta_2} \\
  \theta &= - \frac{\beta_1}{2 \beta_2} \\
  \delta &= - \frac{\beta_1}{2 \beta_2} - (-\frac{\beta_1 + \beta_4}{2 (\beta_2 + \beta_5)}) \\
  \tau &= \sqrt{-\frac{1}{2 \beta_2}}
\end{align*}

```{r schema_param, fig.cap = "", fig.align='center'}

img <- png::readPNG(here::here("results", "figs", "schema_parameters.png"))
grid::grid.raster(img)

```

Figure S1.1: Schematic representation of ecological parameters that describes species-environment relationship.

### References

Jamil T., Kruk C., & Braak C.J.F. ter (2014) A Unimodal Species Response Model Relating Traits to Environment with Application to Phytoplankton Communities. _PLoS ONE_, **9**, e97583.

Michaelis J. & Diekmann M.R. (2017) Biased niches – Species response curves and niche attributes from Huisman-Olff-Fresco models change with differing species prevalence and frequency. _PLOS ONE_, **12**, e0183152.

\newpage
## Appendix S2: Description of performance metrics used in the simulation study


The four performance metrics used (bias, RMSE, interval coverage and interval score) are computed for each model at different levels (species, scenario, overall). First, for each species $i$ included in a particular scenario $s$, we computed average perfomance metrics over the thirty replications:

* Bias of species $i$ in scenario $s$ based on method $m$ is defined as the average of differences between absolute^[Absolute values are took because true shifts could either be positive or negative, thus a negative bias always represents an underestimation of the true shif magnitude whatever its direction.] estimates based on method $m$ and absolute true shift over the thirty replications:

$$Bias_{i,s,m} = \frac{1}{R} \sum_{r=1}^{R}|\hat{\delta}_{i,s,m,r}| - |\delta_{i,s}| \text{ ;}$$

* The RMSE at species-specific level is defined by:

$$RMSE_{i,s,m} = \sqrt{\frac{1}{R}\sum_{r=1}^{R} (\hat{\delta}_{i,s,m} - \delta_{i,s})^2} \text{ ;}$$

* The interval coverage for a species in a particular scenario is the ratio between the number of replciations in which confidence interval estimate contain the true shift and the total number of replications;

* The interval score of species $i$ in scenario $s$ based on method $m$ is defined as the average of interval scores obtained at each replication $r$. At the replication level, interval score is computed as follows:

\begin{equation*}
IS_{i,s,m,r}(l_{i,s,m,r}, u_{i,s,m,r}; \delta_{i,s}) = 
\begin{cases}
(u_{i,s,m,r}-l_{i,s,m,r}) + \frac{2}{\alpha}(l_{i,s,m,r} - \delta_{i,s}) &\text{if $\delta_{i,s} < l_{i,s,m,r}$}\\
(u_{i,s,m,r}-l_{i,s,m,r}) &\text{if $u_{i,s,m,r} > \delta_{i,s} > l_{i,s,m,r}$}\\
(u_{i,s,m,r}-l_{i,s,m,r}) + \frac{2}{\alpha}(\delta_{i,s} - u_{i,s,m,r}) &\text{if $\delta_{i,s} > u_{i,s,m,r}$}
\end{cases}
\end{equation*}

where $\alpha$ is the confidence level of the interval, here set at 0.05, $l_{i,s,m,r}$ and $u_{i,s,m,r}$ are the lower and upper limits of the interval estimated by model $m$ for species $i$ in scenario $s$ and replicate $r$. 
	    
At the scenario level, metrics are averaged over the twenty species:
$$\overline{Bias}_{s,m} = \frac{1}{N} \sum_{i=1}^{N} Bias_{i,s,m}$$
$$\overline{RMSE}_{s,m} = \frac{1}{N} \sum_{i=1}^{N} RMSE_{i,s,m}$$
$$\overline{Coverage}_{s,m} = \frac{1}{N} \sum_{i=1}^{N} Coverage_{i,s,m}$$
$$\overline{IS}_{s,m} = \frac{1}{N} \frac{1}{R} \sum_{i=1}^{N} \sum_{r=1}^{R} IS(\hat{l}_{i,s,m,r}, \hat{u}_{i,s,m,r}; \delta_{i,s})$$

\newpage

## Appendix S3: Complementary results of the simulation study

```{r setup, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# set chunk default options for the document
knitr::opts_chunk$set(echo=FALSE, 
                      message=FALSE, 
                      warning=FALSE, 
                      fig.pos = 'H',
                      fig.align = 'center')

library(knitr)
library(bookdown)
source(here::here("make.R"))
```

\setcounter{table}{0}  
\def\tablename{Table S3.}

```{r convergence_cglmm}
tabS1 %>%
  dplyr::bind_cols("pos" = c(5:8, 1:4)) %>%
  dplyr::arrange(pos) %>%
  dplyr::select(-pos) %>%
  kableExtra::kable(format = "latex",
                    caption = "Number of simulation replications per scenario that at least one model parameter had an R-hat higher than 1.1 after the maximum of iterations was reached", booktabs = TRUE) %>%
  kableExtra::kable_styling(latex_options = "HOLD_position") %>%
  kableExtra::pack_rows("Uniform sampling", 1, 4) %>%
  kableExtra::pack_rows("Unbalanced sampling", 5, 8)
```


```{r computation_time}
tabS2 %>%
  dplyr::bind_cols("pos" = c(5:8, 1:4)) %>%
  dplyr::arrange(pos) %>%
  dplyr::select(-pos) %>%
  kableExtra::kable(format = "latex",
                    caption = "Average computation times in hours.",
                    booktabs = TRUE,
                    row.names = NA) %>%
  kableExtra::kable_styling(latex_options = "HOLD_position") %>%
  kableExtra::pack_rows("Uniform sampling", 1, 4) %>%
  kableExtra::pack_rows("Unbalanced sampling", 5, 8)
```


```{r}
tabS3 %>%
  dplyr::bind_cols("pos" = rep(c(5:8, 1:4), 4),
                   "metric" = rep(c("bias", "cov", "is", "rmse"), each = 8)) %>%
  dplyr::arrange(metric, pos) %>%
  dplyr::select(-c(pos, metric)) %>%
  kableExtra::kable(format = "latex",
                    caption = "Average of species specific performance metrics for the eight simulated scenarios after 30 replications. Numbers in brackets represent standard deviations. ",
                    booktabs = TRUE,
                    longtable = TRUE) %>%
  kableExtra::kable_styling(latex_options = "HOLD_position") %>%
  kableExtra::pack_rows("Bias", 1, 8) %>%
  kableExtra::pack_rows("Coverage", 9, 16) %>%
  kableExtra::pack_rows("IS", 17, 24) %>%
  kableExtra::pack_rows("RMSE", 25, 32)
```


```{r esm_graph_IS, fig.dim = c(8.3, 11.7), fig.align = 'center', fig.cap=""}

gridExtra::grid.arrange(g.IS, g.IS2, nrow = 2)

```

Figure S3.1: Distribution of species specific interval scores (IS) for the eight simulated scenarios after 30 replications, and for the three methods (top graph) or without cGLMM (bottom graph). Colored points represent average IS in species group depending on their optimum position (placed in the edge or in the middle of sampling range) along the simulated gradient, and their ecological specialization type relative to the width of their ecological niche (generalist species with broad ecological niche or specialist species with narrower ecological niche).

\newpage
\setcounter{table}{0}  
\def\tablename{Table S4.}

## Appendix S4: Departure from symmetric assumption

Models used in the manuscript make the assumption that species have symmetric unimodal relationships with environmental gradient (i.e. occupancy probabilities decrease at the same rate on both side of optimum, see Fig. S4.1). Species-environment relationships could however have other forms [@oksanen2002; @jansen2013]. For instance, species response curve (SRC) could be unimodal but skewed to one part of the gradient (i.e. asymmetric). Here we propose to investigate the effect of departure from models' assumption of symmetric unimodal species-gradient relationships on models accuracy by conducting a simulation study.

```{r, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}

source(here::here("analysis/review01_simu_assymetric_curves.R"))
source(here::here("analysis/review05_make-figs-tabs-results_asymSRC.R"))
```

```{r figure type of SRC, fig.cap = "", fig.align='center'}
x <- 1000:3000
y.sym <- src_asym(x = x, opt = 2000, sd_l = 100, sd_r = 100, max = 0.9) # sd chose to simulate a width around 450
y.asym_l <- src_asym(x = x, opt = 2000, sd_l = 150, sd_r = 100, max = 0.9) 
y.asym_r <- src_asym(x = x, opt = 2000, sd_l = 100, sd_r = 150, max = 0.9)

# Figure: Representation of the three types of species response curves. 
data.frame("x" = x,
           "y" = c(y.sym, y.asym_l, y.asym_r),
           "toc" = rep(c("1sym", "2asym_l", "2asym_r"), each = length(x))) %>%
  ggplot(aes(x = x, y = y, col = toc)) +
  geom_line(aes(linetype = toc),size = 1.5, alpha = 0.6) +
  geom_segment(aes(x = 2000, xend = 2000, y = 0, yend = 0.9),
               col = "grey20",
               lty = 2) +
  ylim(c(0, 1)) +
  scale_color_manual(values = c("grey40", "red", "darkgreen"),
                     labels = c("Symmetric", "Left-skewed", "Right-skewed")) +
  scale_linetype_manual(values = c(1, 6, 6),
                        labels = c("Symmetric", "Left-skewed", "Right-skewed")) +
  labs(color = "Type of SRC",
       linetype = "Type of SRC") +
  theme_bw()
```

Fig S4.1: Three types of species response curves sharing a same optimum (dashed vertical segment).

### Simulated datasets

We defined three potential shapes of species response curves: symmetric, asymmetric with a longer left tail and asymmetric with a longer right tail (Fig. S4.1). We simulated 9 species to describe all possible combinations of SRC that could occur when two sampling occasions are considered (Fig. S4.2). To keep it simple we chose to only simulate specialist species, shifting upward and having their optima of both sampling occasions in the middle of the sampling range. We simulated curve widths ranged from 400 m to 600 m. Maximum occupancy probabilities were obtained by random draws from a uniform distribution bounded between 0.85 and 0.99. Species optima were randomly positioned between 1490 m and 2460 m, in the middle range of the unbalanced sampling design (i.e. sampling scenario A2 of the manuscript). We assigned only upward shifts following random draws from a uniform distribution bounded between 80 and 120 m (Fig. S4.2).

```{r simulated curves, fig.height=10, fig.width=8}
curve.type1 <- rep(c("Sym", #symmetric
                        "R-skd", #asymmetric to the right
                        "L-skd"), #asymmetric to the left
                      3)

curve.type2 <- rep(c("Sym", #symmetric
                        "R-skd", #asymmetric to the right
                        "L-skd"), #asymmetric to the left
                      each = 3)

par(mfrow = c(3,3))
for (i in 1:N){
  plot(X_A1[order(X_A1)], psi[,i,1,1], 
       type = "l", 
       xlab = "", ylab = "", 
       ylim = c(0,1.05),
       xlim = range(X_A1),
       col = "blue",
       main = paste(curve.type1[i],
                    curve.type2[i]))
  segments(x0 = data.sp[i, ]$opt,
           x1 = data.sp[i, ]$opt,
           y0 = - 1, 
           y1 = data.sp[i, ]$max.occ1,
           lty = 2,
           col = "blue")
  lines(X_A1[order(X_A1)], psi[,i,2,1],
        col = "red")
  segments(x0 = (data.sp[i, ]$opt + data.sp[i, ]$shift),
           x1 = (data.sp[i, ]$opt + data.sp[i, ]$shift),
           y0 = - 1, 
           y1 = data.sp[i, ]$max.occ2,
           lty = 2,
           col = "red")
  text(x = (data.sp[i, ]$opt + data.sp[i, ]$shift / 2),
       y = 1,
       labels = paste("+", round(data.sp[i, ]$shift, 0), "m"))
  arrows(x0 = (data.sp[i, ]$opt),
         x1 = (data.sp[i, ]$opt + data.sp[i, ]$shift),
         y0 = 0.95, 
         y1 = 0.95,
         length = 0.05)
}
```

Fig S4.2: Species response curves of the nine simulated species. Blue curves represent the SRCs of the first sampling occasion. Panel titles indicates the shapes of the two SRCs, with sym, r_skd and l_skd standing for symmetric, right-skewed and left-skewed.

Species response curves were simulated using a mixture of two normal distributions with a common mean and two variance parameters (see Eq. (1) bellow). The common mean represents the species optimum. The two variances are related to the width of the SRC at each side of the species optimum. The first distribution (resp. second) is used to simulate the left (resp. right) side of the optimum of the SRC. Hence, if the first normal distribution has a greater standard deviation than the second normal distribution, the curve will be left-skewed. If both distribution have the same standard deviation, the SRC is symmetric. Note that we used the density function of the normal distribution multiplied by a scaling parameter to reach a specified probability. The scaling parameter is defined as the ratio of the maximum occupancy probability intended and the maximum density of the normal distribution. We simulated the site-specific probability of occupancy for each species as follows:

```{=tex}
\begin{equation}
    \psi^s_{i,j,k} =
    \begin{cases}
      a_i \frac{exp( - \frac{(x^s_j - (\theta_i + (S_k \times \delta_i)))^2}{2 \sigma_1i ^ 2} )}{\sigma_1i \sqrt{2 \pi}} & \text{for $x^s_j \leq \theta_i$}\\
      b_i \frac{exp( - \frac{(x^s_j - \theta_i + (S_k \times \delta_i))^2}{2 \sigma_2i ^ 2} )}{\sigma_2i \sqrt{2 \pi}} & \text{for $x^s_j > \theta_i$}
    \end{cases}
\end{equation}
```
with $a_i$ and $b_i$ the scaling parameters related to the maximum probability, $\theta$ the species optimum, $\delta$ the species shift and $\sigma$ the standard deviations related to the width.

Once SRCs were simulated for each species and sampling occasion, we generated presence/absence data, $Y^s_{i,j,k}$, from random draws of a Bernoulli distribution: $Y^s_{i,j,k} \sim \text{Bernoulli}(\psi^s_{i,j,k})$. We replicated the process 30 times for the two sampling scenarios. Contrary to the manuscript simulation design, here the simulated parameters of the SRCs ($a_i$, $\theta_i$, $\delta_i$, $\sigma_i$) were identical for the two sampling scenarios.

### Accuracy of optimum shift estimates under violiation of the symmetry assumption

In our simulations, all three methods respond in the same way to departure from assumption of symmetric unimodal species-gradient relationships (Fig. S4.3, Table S4.1). More than the departure of symmetry assumption, the models are sensitive to changes in SRC shapes between the two sampling occasions. The more difference between SRC shapes, the larger the bias for all methods. For instance, the highest bias were obtained for species having a SRC skewed toward one side of the gradient at the first sampling occasion and a SRC skewed toward the other side in the next sample (e.g. left-skewed to right-skewed). In contrast, methods produced accurate optimum shift estimates for species having same skewness during the two sampling occasions (e.g. species 5).

```{r include=FALSE}
full.res.shift %>%
  dplyr::mutate("abs.bias" = abs(estim.shift - true.shift)) %>%
  dplyr::group_by(model, scenario) %>%
  dplyr::summarise_at("abs.bias", c("mean" = mean, "sd" = sd)) -> summary_abs.bias


full.res.shift %>%
  dplyr::mutate("bias" = estim.shift - true.shift) %>%
  dplyr::filter(sp %in% paste0("sp", c(1, 5, 9))) %>%
  dplyr::group_by(model, scenario) %>%
  dplyr::summarise_at("bias", c("mean" = mean, "sd" = sd))

summary_bias %>%
  dplyr::mutate("mean" = abs(mean)) %>%
  dplyr::group_by(model, scenario) %>%
  dplyr::summarise_at("mean", mean)

summary_bias %>%
  dplyr::filter(sp %in% paste0("sp", c(2, 3, 4, 6, 7, 8))) %>%
  dplyr::mutate("mean" = abs(mean)) %>%
  dplyr::group_by(model, scenario) %>%
  dplyr::summarise_at("mean", mean)
```

```{r bias table}
summary_bias %>%
  dplyr::ungroup() %>%
  dplyr::inner_join(full.res.shift[, c("sp", "true.shift")], by = "sp") %>%
  dplyr::distinct() %>%
  dplyr::mutate("true.shift" = round(true.shift),
                "bias" = paste0(round(mean), " (", round(sd), ")")) %>%
  dplyr::select(-c('mean', "sd")) %>%
  tidyr::pivot_wider(names_from = model, values_from = bias) %>%
  dplyr::mutate("SRC 1" = rep(rep(c("Symmetric", 
                                 "Right-skewed", 
                                 "Left-skewed"), 
                               3), 2),
                "SRC 2" = rep(rep(c("Symmetric", 
                                 "Right-skewed", 
                                 "Left-skewed"), 
                               each = 3), 2)) %>%
  dplyr::rename("True shift" = "true.shift", 
                "EHMOS" = "ehmos", 
                "cGLMM" = "glmm", 
                "t-test" = "t.test")  %>%
  dplyr::select(c("SRC 1", "SRC 2", "True shift", "EHMOS", "cGLMM", "t-test")) %>%
  kableExtra::kable(format = "latex",
                    caption = "Average of bias in optimum shift estimates for the two simulated scenarios after 30 replications. Numbers in brackets represent standard deviations. ",
                    booktabs = TRUE,
                    longtable = TRUE) %>%
  kableExtra::kable_styling(latex_options = "HOLD_position") %>%
  kableExtra::pack_rows("Sampling scenario A2", 1, 9) %>% # inversion of scenario names during data simulation
  kableExtra::pack_rows("Sampling scenario A1", 10, 18)
```

```{r bias figure}
full.res.shift %>%
  dplyr::mutate("bias" = (estim.shift - true.shift)) %>%
  ggplot(aes(x = sp, y = bias)) +
  geom_point(color = alpha("grey20", 0.4)) +
  facet_grid(scenario ~ model,
             labeller = labeller(.rows = c("A1" = "A2", "A2" = "A1"))) + # correct past error of confounding names when creating data
  geom_point(data = summary_bias,
             aes(x = sp, y = mean), 
             color = "red",
             size = 2) +
  geom_segment(data = summary_bias,
               aes(x = sp, 
                   xend = sp, 
                   y = mean - sd,
                   yend = mean + sd), 
               color = "red") +
  ylab("Bias (m)") +
  scale_x_discrete(labels = paste(curve.type1,
                    curve.type2)) +
  theme_bw() +
  theme(axis.text.x = element_text(vjust = 1,
                                   hjust = 1,
                                   angle = 45),
        axis.title.x = element_blank())
```

Figure S4.3: Bias in optimum shift estimates with simulated species having different kinds of unimodal species response curves (symmetric, right-skewed or left-skewed). Grey points correspond to results from one replication. Mean bias are represented with their standard deviations by red points and red segments.

### Detection of departure from model assumption

We tried two approaches to test the departure from the symmetry assumption made by the three presented models: 1) a Bayesian P-value approach that is often used by ecologists to detect a lack-of-fit in Bayesian models [@conn2018], and 2) a HOF approach previously used to test for the symmetry assumption in range shift studies [@wilson2005].

#### Goodness-of-fit

We assess quality of model fit using a Bayesian P-value approach [@gelman2013] for each species. We used the discrepancy measure defined by @zipkin2009: $D(y_i) = \sum_{k}(y_{ik} - \hat\psi_{ik})^2$ for the presence-absence observations $y_{ik}$ of species $i$ and their expected values $\hat\psi_{ik}$ under the model at MCMC replication $k$. This discrepancy statistic is computed independently for each species $i$. A reference distribution is computed by simulating data sets from the posterior distribution, $y_{ik}^{sim} \sim p(\theta_{ik} | y)$, and computing the discrepancy measure, $D(y_{ik}^{sim})$, for the simulated data sets. The Bayesian p-value for species $i$ is defined as the probability: $p_{Bi} = \text{Pr}(D(y_i)>D(y_i^{sim}))$. Extreme values (e.g. less than 0.05 or greater than 0.95) are interpreted as a lack of fit. 

```{r table GoF}
data.frame("SRC 1" = rep(c("Symmetric", 
                                 "Right-skewed", 
                                 "Left-skewed"), 
                               3),
                "SRC 2" = rep(c("Symmetric", 
                                 "Right-skewed", 
                                 "Left-skewed"), 
                               each = 3),
           "cGLMM" = apply(bp.sp_glmm, 1, function(x)(sum(x < 0.05 | x > 0.95))),
           "EHMOS" = apply(bp.sp_ehmos, 1, function(x)(sum(x < 0.05 | x > 0.95)))) %>%
  kableExtra::kable(format = "latex",
                    caption = "Number of times where lack-of-fit were detected after 30 replications for the 9 species simulated with different shapes of response.",
                    booktabs = TRUE,
                    longtable = TRUE) %>%
  kableExtra::kable_styling(latex_options = "HOLD_position")
``` 

We detected no lack-of-fit according to the Bayesian p-value approach, except for one species in one replication of the simulation (Table S4.2). 

Bayesian p-value approach seems conservative in regards of skewed species response. Thus, it should not be used to investigate departure from model assumption on shape of species response.

#### HOF approach

HOF approach consists in applying seven models and select the model that best fit the data [@huisman1993; @jansen2013]. The five models describe five shapes of response curves assumed to be ecologically meaningful [@oksanen2002; @jansen2013]: I) flat, II) monotone, III) plateau, IV) unimodal symmetric, V) unimodal skewed, VI) bimodal symmetric and VII) bimodal skewed. This approach has been used to determine the shape of species response along environmental gradients in many studies [e.g. @oksanen2002; @jansen2013; @michaelis2017], and especially in range shift studies [@urli2014, @wilson2005]. For instance, @wilson2005 used the HOF approach to verify the assumption of symmetrical species response curves made by their two-GLMs approach. We tested this method on our simulated data sets. We applied the HOF approach on each replicated data set and each species for sampling occasion one using the `HOF` function of the R-package `eHOF` [@jansen2013].

```{r}
shape.hat %>% 
  as.data.frame() %>% 
  dplyr::mutate_all(as.factor) %>% 
  tidyr::pivot_longer(cols = 1:9,
                      names_to = "species",
                      values_to = "hof_shape") %>%
  dplyr::group_by(species) %>%
  dplyr::count(hof_shape) %>%
  tidyr::pivot_wider(names_from = "hof_shape",
                     values_from = "n") %>%
  dplyr::ungroup() -> hof_res

hof_res[is.na(hof_res)] <- 0

hof_res %>%
  dplyr::mutate("species" = 1:9,
                "true shape" = rep(c("Symmetric (IV)", 
                                 "Right-skewed (V)", 
                                 "Left-skewed (V)"), 
                               3)) %>%
  dplyr::select(1, 5, 2:4) %>%
  kableExtra::kable(format = "latex",
                    caption = "Model choices of the HOF approach for the 9 simulated species after 30 replications.",
                    booktabs = TRUE,
                    longtable = TRUE) %>%
  kableExtra::add_header_above(c(" " = 2, "HOF models" = 3))
```

The HOF approach failed to retrieve the correct shape for numerous species and iterations (Table S4. 3). It estimated symmetrical response in majority of replications even for species having skewed response. Species with symmetrical responses had been misclassified in at least 15\% of the replications. 

### Discussion

We found that departure from assumption of symmetry in species response could induce bias in optimum shift estimates of the three methods. The estimates were biased when degree of skewness in species response changed between the two sampling occasions. Thus, readers should be cautious regarding the shape of species response curves, and more importantly in the potential changes in shapes of SRC between the samples studied, before applying any of the three methods presented here. 

We tried two approaches in order to detect departure from model assumption of symmetry in SRC: 1) Bayesian p-value approach as a measure of goodness-of-fit [@gelman2013] and 2) HOF approach that were used by @wilson2005 in this context. None was found to be a reliable evaluation of the symmetry assumption based on our simulations. This could be due to the relatively low degree of skewness of the simulated SRCs, but previous works have also shown that HOF approach could misclassify SRC shapes even with high degree of skewness [@jansen2013; @michaelis2017]. @jansen2013 found for instance that HOF approach could be sensitive to optimum position along the environmental gradient. Their results indicate numerous misclassifications of HOF approach (see Table 4 and Fig. A3 in @jansen2013), especially (but not only) for species having their optimum close to sampling limits (i.e. edge species). These results also stand for GAMs [@jansen2013; @citores2020]. Besides, @oksanen2002 pointed out that defining symmetry or asymmetry with GAMs could be subjective and thus advice to use of HOF approach. For these reasons we do not used GAMs for testing the symmetry assumption.

### Conlusion

It appears important to thoroughly inspect SRC shape before analysis due to potential bias when SRC shapes change over sampling occasions. More researches are needed to be able to test for asymmetrical SRC, especially simulation studies. Ecologists could also rely on more precise data, e.g. abundance data, when they are available to test the assumption of symmetrical speceis response curves.

### References

Citores L., Ibaibarriaga L., Lee D.-J., Brewer M.J., Santos M., & Chust G. (2020) Modelling species presence–absence in the ecological niche theory framework using shape-constrained generalized additive models. _Ecological Modelling_, **418**, 108926.

Conn P.B., Johnson D.S., Williams P.J., Melin S.R., & Hooten M.B. (2018) A guide to bayesian model checking for ecologists. _Ecological Monographs_, **88**, 526–542.

Gelman A., Carlin J.B., Stern H.S., Dunson D.B., Vehtari A., & Rubin D.B. (2013) _Bayesian Data Analysis_. Chapman; Hall, New York.

Huisman J., Olff H., & Fresco L. (1993) A hierarchical set of models for species response analysis. _Journal of Vegetation Science_, **4**, 37–46.

Jansen F. & Oksanen J. (2013) How to model species responses along ecological gradients–huisman–olff–f resco models revisited. _Journal of Vegetation Science_, **24**, 1108–1117.

Michaelis J. & Diekmann M.R. (2017) Biased niches – Species response curves and niche attributes from Huisman-Olff-Fresco models change with differing species prevalence and frequency. _PLOS ONE_, **12**, e0183152.

Oksanen J. & Minchin P.R. (2002) Continuum theory revisited: What shape are species responses along ecological gradients? _Ecological Modelling_, **157**, 119–129.

Urli M., Delzon S., Eyermann A., Couallier V., García-Valdés R., Zavala M.A., & Porté A.J. (2014) Inferring shifts in tree species distribution using asymmetric distribution curves: A case study in the Iberian mountains. _Journal of Vegetation Science_, **25**,
147–159.

Wilson R.J., Gutiérrez D., Gutiérrez J., Martínez D., Agudo R., & Monserrat V.J. (2005) Changes to the elevational limits and extent of species ranges associated with climate change. _Ecology letters_, **8**, 1138–1146.

Zipkin E.F., DeWan A., & Royle J.A. (2009) Impacts of forest fragmentation on species richness: A hierarchical approach to community modelling. _Journal of Applied Ecology_, **46**, 815–822.
